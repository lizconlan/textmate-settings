<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
	"http://www.w3.org/TR/html4/strict.dtd">

<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<link href="css/print.css" rel="stylesheet" type="text/css" media="all">
	<title>TextMate Manual</title>
</head>

<body>
	<div id="wrapper">
		<div id="toc">
			
<ol>
    <li>1 <a href="preface#preface">Preface</a>
    <ol>
        <li>1.1 <a href="preface#about_the_documentation">About the Documentation</a></li>
        <li>1.2 <a href="preface#philosophy_of_textmate">Philosophy of TextMate</a></li>
        <li>1.3 <a href="preface#terminology">Terminology</a></li>
        <li>1.4 <a href="preface#limitations">Limitations</a></li>
    </ol>
    </li>
    <li>2 <a href="working_with_multiple_files#working_with_multiple_files">Working With Multiple Files</a>
    <ol>
        <li>2.1 <a href="working_with_multiple_files#creating_projects_with_tabs">Creating Projects (With Tabs)</a>
        <ol>
            <li>2.1.1 <a href="working_with_multiple_files#auto-updating_projects">Auto-Updating Projects</a></li>
            <li>2.1.2 <a href="working_with_multiple_files#filtering_unwanted_files">Filtering Unwanted Files</a></li>
            <li>2.1.3 <a href="working_with_multiple_files#text_and_binary_files">Text and Binary Files</a></li>
            <li>2.1.4 <a href="working_with_multiple_files#positioning_the_project_drawer">Positioning the Project Drawer</a></li>
        </ol>
        </li>
        <li>2.2 <a href="working_with_multiple_files#find_and_replace_in_projects">Find and Replace in Projects</a></li>
        <li>2.3 <a href="working_with_multiple_files#moving_between_files_with_grace">Moving Between Files (With Grace)</a></li>
    </ol>
    </li>
    <li>3 <a href="navigation_overview#navigation_overview">Navigation / Overview</a>
    <ol>
        <li>3.1 <a href="navigation_overview#bookmarks">Bookmarks</a></li>
        <li>3.2 <a href="navigation_overview#collapsing_text_blocks_foldings">Collapsing Text Blocks (Foldings)</a>
        <ol>
            <li>3.2.1 <a href="navigation_overview#customizing_foldings">Customizing Foldings</a></li>
        </ol>
        </li>
        <li>3.3 <a href="navigation_overview#function_pop-up">Function Pop-up</a>
        <ol>
            <li>3.3.1 <a href="navigation_overview#customizing_the_list">Customizing the List</a></li>
        </ol>
        </li>
    </ol>
    </li>
    <li>4 <a href="working_with_text#working_with_text">Working With Text</a>
    <ol>
        <li>4.1 <a href="working_with_text#auto-paired_characters_quotes_etc">Auto-Paired Characters (Quotes etc.)</a></li>
        <li>4.2 <a href="working_with_text#completion">Completion</a></li>
        <li>4.3 <a href="working_with_text#copy_and_paste">Copy and Paste</a>
        <ol>
            <li>4.3.1 <a href="working_with_text#clipboard_history">Clipboard History</a></li>
            <li>4.3.2 <a href="working_with_text#re-indented_paste">Re-indented Paste</a></li>
        </ol>
        </li>
        <li>4.4 <a href="working_with_text#editing_modes">Editing Modes</a>
        <ol>
            <li>4.4.1 <a href="working_with_text#freehanded_editing">Freehanded Editing</a></li>
            <li>4.4.2 <a href="working_with_text#overwrite_mode">Overwrite Mode</a></li>
        </ol>
        </li>
        <li>4.5 <a href="working_with_text#find_and_replace">Find and Replace</a>
        <ol>
            <li>4.5.1 <a href="working_with_text#inserting_newlines_and_tabs_in_the_find_dialog">Inserting Newlines and Tabs in the Find Dialog</a></li>
            <li>4.5.2 <a href="working_with_text#find_clipboard">Find Clipboard</a></li>
        </ol>
        </li>
        <li>4.6 <a href="working_with_text#moving_text">Moving Text</a>
        <ol>
            <li>4.6.1 <a href="working_with_text#increase_decrease_indent_level">Increase/Decrease Indent Level</a></li>
            <li>4.6.2 <a href="working_with_text#move_text_up_down_left_right">Move Text Up/Down/Left/Right</a></li>
            <li>4.6.3 <a href="working_with_text#re-indent_text">Re-indent Text</a></li>
        </ol>
        </li>
        <li>4.7 <a href="working_with_text#selecting_text">Selecting Text</a>
        <ol>
            <li>4.7.1 <a href="working_with_text#editing_multiple_lines">Editing Multiple Lines</a></li>
            <li>4.7.2 <a href="working_with_text#column_selections">Column Selections</a></li>
        </ol>
        </li>
        <li>4.8 <a href="working_with_text#column_movement_typing">Column Movement / Typing</a></li>
        <li>4.9 <a href="working_with_text#smart_tab_behavior">Smart Tab Behavior</a></li>
        <li>4.10 <a href="working_with_text#spell_checking">Spell Checking</a></li>
        <li>4.11 <a href="working_with_text#using_spaces_instead_of_tabs">Using Spaces Instead of Tabs</a></li>
    </ol>
    </li>
    <li>5 <a href="bundles#bundles">Bundles</a>
    <ol>
        <li>5.1 <a href="bundles#activation_of_bundle_items">Activation of Bundle Items</a>
        <ol>
            <li>5.1.1 <a href="bundles#key_equivalents">Key Equivalents</a></li>
            <li>5.1.2 <a href="bundles#tab_triggers">Tab Triggers</a></li>
        </ol>
        </li>
        <li>5.2 <a href="bundles#editing_default_bundles_items">Editing Default Bundles / Items</a></li>
        <li>5.3 <a href="bundles#deleting_default_bundles_items">Deleting Default Bundles / Items</a></li>
        <li>5.4 <a href="bundles#hiding_bundles">Hiding Bundles</a></li>
        <li>5.5 <a href="bundles#sharing_bundles_and_bundle_items">Sharing Bundles and Bundle Items</a></li>
        <li>5.6 <a href="bundles#assorted_bundles">Assorted Bundles</a>
        <ol>
            <li>5.6.1 <a href="bundles#diff">Diff</a></li>
            <li>5.6.2 <a href="bundles#html">HTML</a></li>
            <li>5.6.3 <a href="bundles#latex">LaTeX</a></li>
            <li>5.6.4 <a href="bundles#source">Source</a></li>
            <li>5.6.5 <a href="bundles#sql">SQL</a></li>
            <li>5.6.6 <a href="bundles#subversion">Subversion</a></li>
            <li>5.6.7 <a href="bundles#text">Text</a></li>
            <li>5.6.8 <a href="bundles#textmate">TextMate</a></li>
            <li>5.6.9 <a href="bundles#xcode">Xcode</a></li>
        </ol>
        </li>
        <li>5.7 <a href="bundles#getting_more_bundles">Getting More Bundles</a>
        <ol>
            <li>5.7.1 <a href="bundles#installing_subversion">Installing Subversion</a></li>
            <li>5.7.2 <a href="bundles#setting_lc_ctype">Setting <code>LC_CTYPE</code></a></li>
            <li>5.7.3 <a href="bundles#installing_a_bundle">Installing a Bundle</a></li>
            <li>5.7.4 <a href="bundles#support_folder">Support Folder</a></li>
            <li>5.7.5 <a href="bundles#rss_feed_with_bundle_change_log">RSS Feed With Bundle Change Log</a></li>
        </ol>
        </li>
    </ol>
    </li>
    <li>6 <a href="macros#macros">Macros</a></li>
    <li>7 <a href="snippets#snippets">Snippets</a>
    <ol>
        <li>7.1 <a href="snippets#plain_text">Plain Text</a></li>
        <li>7.2 <a href="snippets#variables">Variables</a></li>
        <li>7.3 <a href="snippets#interpolated_shell_code">Interpolated Shell Code</a></li>
        <li>7.4 <a href="snippets#tab_stops">Tab Stops</a></li>
        <li>7.5 <a href="snippets#placeholders">Placeholders</a></li>
        <li>7.6 <a href="snippets#mirrors">Mirrors</a></li>
        <li>7.7 <a href="snippets#transformations">Transformations</a></li>
    </ol>
    </li>
    <li>8 <a href="shell_commands#shell_commands">Shell Commands</a>
    <ol>
        <li>8.1 <a href="shell_commands#executing_commands_filtering_text">Executing Commands / Filtering Text</a></li>
        <li>8.2 <a href="shell_commands#search_path">Search Path</a></li>
    </ol>
    </li>
    <li>9 <a href="environment_variables#environment_variables">Environment Variables</a>
    <ol>
        <li>9.1 <a href="environment_variables#dynamic_variables">Dynamic Variables</a></li>
        <li>9.2 <a href="environment_variables#static_variables">Static Variables</a></li>
        <li>9.3 <a href="environment_variables#context_dependent_variables">Context Dependent Variables</a></li>
        <li>9.4 <a href="environment_variables#project_dependent_variables">Project Dependent Variables</a></li>
    </ol>
    </li>
    <li>10 <a href="commands#commands">Commands</a>
    <ol>
        <li>10.1 <a href="commands#command_input">Command Input</a></li>
        <li>10.2 <a href="commands#command_output">Command Output</a></li>
        <li>10.3 <a href="commands#html_output">HTML Output</a></li>
        <li>10.4 <a href="commands#changing_output_type">Changing Output Type</a></li>
        <li>10.5 <a href="commands#useful_bash_functions">Useful bash Functions</a></li>
        <li>10.6 <a href="commands#dialogs_requesting_input_showing_progress">Dialogs (Requesting Input & Showing Progress)</a></li>
    </ol>
    </li>
    <li>11 <a href="drag_commands#drag_commands">Drag Commands</a></li>
    <li>12 <a href="language_grammars#language_grammars">Language Grammars</a>
    <ol>
        <li>12.1 <a href="language_grammars#example_grammar">Example Grammar</a></li>
        <li>12.2 <a href="language_grammars#language_rules">Language Rules</a></li>
        <li>12.3 <a href="language_grammars#rule_keys">Rule Keys</a></li>
        <li>12.4 <a href="language_grammars#naming_conventions">Naming Conventions</a></li>
    </ol>
    </li>
    <li>13 <a href="scope_selectors#scope_selectors">Scope Selectors</a>
    <ol>
        <li>13.1 <a href="scope_selectors#element_names">Element Names</a></li>
        <li>13.2 <a href="scope_selectors#descendant_selectors">Descendant Selectors</a></li>
        <li>13.3 <a href="scope_selectors#excluding_elements">Excluding Elements</a></li>
        <li>13.4 <a href="scope_selectors#grouping">Grouping</a></li>
        <li>13.5 <a href="scope_selectors#ranking_matches">Ranking Matches</a></li>
    </ol>
    </li>
    <li>14 <a href="themes#themes">Themes</a>
    <ol>
        <li>14.1 <a href="themes#sharing">Sharing</a></li>
    </ol>
    </li>
    <li>15 <a href="preferences_items#preferences_items">Preferences Items</a>
    <ol>
        <li>15.1 <a href="preferences_items#completions">Completions</a></li>
        <li>15.2 <a href="preferences_items#indentation">Indentation</a></li>
        <li>15.3 <a href="preferences_items#symbol_list">Symbol List</a></li>
        <li>15.4 <a href="preferences_items#paired_characters">Paired Characters</a></li>
        <li>15.5 <a href="preferences_items#other">Other</a></li>
    </ol>
    </li>
    <li>16 <a href="key_bindings#key_bindings">Key Bindings</a>
    <ol>
        <li>16.1 <a href="key_bindings#bundle_items">Bundle Items</a></li>
        <li>16.2 <a href="key_bindings#menu_items">Menu Items</a></li>
        <li>16.3 <a href="key_bindings#text_move_edit_actions">Text Move / Edit Actions</a>
        <ol>
            <li>16.3.1 <a href="key_bindings#list_of_standard_key_bindings">List of Standard Key Bindings</a></li>
        </ol>
        </li>
        <li>16.4 <a href="key_bindings#conventions">Conventions</a></li>
    </ol>
    </li>
    <li>17 <a href="templates#templates">Templates</a></li>
    <li>18 <a href="printing#printing">Printing</a></li>
    <li>19 <a href="saving_files#saving_files">Saving Files</a>
    <ol>
        <li>19.1 <a href="saving_files#atomic_saves">Atomic Saves</a></li>
        <li>19.2 <a href="saving_files#creator_code">Creator Code</a></li>
        <li>19.3 <a href="saving_files#encoding">Encoding</a></li>
        <li>19.4 <a href="saving_files#extended_attributes_metadata">Extended Attributes (Metadata)</a></li>
        <li>19.5 <a href="saving_files#save_automatically_when_focus_is_lost">Save Automatically when Focus Is Lost</a></li>
    </ol>
    </li>
    <li>20 <a href="regular_expressions#regular_expressions">Regular Expressions</a>
    <ol>
        <li>20.1 <a href="regular_expressions#introduction">Introduction</a>
        <ol>
            <li>20.1.1 <a href="regular_expressions#external_resources">External Resources</a></li>
        </ol>
        </li>
        <li>20.2 <a href="regular_expressions#regular_expressions_in_textmate">Regular Expressions in TextMate</a></li>
        <li>20.3 <a href="regular_expressions#syntax_oniguruma">Syntax (Oniguruma)</a></li>
        <li>20.4 <a href="regular_expressions#replacement_string_syntax_format_strings">Replacement String Syntax (Format Strings)</a>
        <ol>
            <li>20.4.1 <a href="regular_expressions#captures">Captures</a></li>
            <li>20.4.2 <a href="regular_expressions#case_foldings">Case Foldings</a></li>
            <li>20.4.3 <a href="regular_expressions#conditional_insertions">Conditional Insertions</a></li>
            <li>20.4.4 <a href="regular_expressions#escape_codes">Escape Codes</a></li>
        </ol>
        </li>
    </ol>
    </li>
    <li>21 <a href="using_textmate_from_terminal#calling_textmate_from_other_applications">Calling TextMate from Other Applications</a>
    <ol>
        <li>21.1 <a href="using_textmate_from_terminal#shell_terminal">Shell / Terminal</a>
        <ol>
            <li>21.1.1 <a href="using_textmate_from_terminal#the_general_editor_variable">The General EDITOR Variable</a></li>
            <li>21.1.2 <a href="using_textmate_from_terminal#git_editor">Git Editor</a></li>
            <li>21.1.3 <a href="using_textmate_from_terminal#tex_editor">TeX Editor</a></li>
            <li>21.1.4 <a href="using_textmate_from_terminal#edit_from_less">Edit from <code>less</code></a></li>
        </ol>
        </li>
        <li>21.2 <a href="using_textmate_from_terminal#url_scheme_html">URL Scheme (HTML)</a></li>
        <li>21.3 <a href="using_textmate_from_terminal#odb_editor_suite">ODB Editor Suite</a></li>
        <li>21.4 <a href="using_textmate_from_terminal#cocoa_text_fields">Cocoa Text Fields</a></li>
    </ol>
    </li>
    <li>22 <a href="expert_preferences#expert_preferences">Expert Preferences</a>
    <ol>
        <li>22.1 <a href="expert_preferences#nsdraganddroptextdelay"><code>NSDragAndDropTextDelay</code></a></li>
        <li>22.2 <a href="expert_preferences#nsrecentdocumentslimit"><code>NSRecentDocumentsLimit</code></a></li>
        <li>22.3 <a href="expert_preferences#oakbundleitemspopupmenukeyequivalent"><code>OakBundleItemsPopUpMenuKeyEquivalent</code></a></li>
        <li>22.4 <a href="expert_preferences#oakbundlemanagerdisambiguatemenufontsize"><code>OakBundleManagerDisambiguateMenuFontSize</code></a></li>
        <li>22.5 <a href="expert_preferences#oakdefaultbundlefornewbundleitems"><code>OakDefaultBundleForNewBundleItems</code></a></li>
        <li>22.6 <a href="expert_preferences#oakdefaultlanguage"><code>OakDefaultLanguage</code></a></li>
        <li>22.7 <a href="expert_preferences#oakdisablesessionrestore"><code>OakDisableSessionRestore</code></a></li>
        <li>22.8 <a href="expert_preferences#oakdocumentcustomfsmetadata"><code>OakDocumentCustomFSMetaData</code></a></li>
        <li>22.9 <a href="expert_preferences#oakdocumentdisablefsmetadata"><code>OakDocumentDisableFSMetaData</code></a></li>
        <li>22.10 <a href="expert_preferences#oakfindpaneldisablehistory"><code>OakFindPanelDisableHistory</code></a></li>
        <li>22.11 <a href="expert_preferences#oaktooltipmousemoveignoreperiod_and_oaktooltipmousedistancethreshold"><code>OakToolTipMouseMoveIgnorePeriod</code> and <code>OakToolTipMouseDistanceThreshold</code></a></li>
        <li>22.12 <a href="expert_preferences#oakwrapcolumns"><code>OakWrapColumns</code></a></li>
        <li>22.13 <a href="expert_preferences#oakwordsexcludedfromcapitalization"><code>OakWordsExcludedFromCapitalization</code></a></li>
    </ol>
    </li>
    <li>23 <a href="getting_help#getting_help">Getting Help</a>
    <ol>
        <li>23.1 <a href="getting_help#mailing_list">Mailing List</a></li>
        <li>23.2 <a href="getting_help#irc_channel">IRC Channel</a></li>
        <li>23.3 <a href="getting_help#other_resources">Other Resources</a>
        <ol>
            <li>23.3.1 <a href="getting_help#textmate_cheat_sheet">TextMate Cheat Sheet</a></li>
            <li>23.3.2 <a href="getting_help#textmate_tutorials">TextMate Tutorials</a></li>
            <li>23.3.3 <a href="getting_help#screencasts">Screencasts</a></li>
        </ol>
        </li>
    </ol>
    </li>
    <li>24 <a href="appendix#appendix">Appendix</a>
    <ol>
        <li>24.1 <a href="appendix#property_list_format">Property List Format</a>
        <ol>
            <li>24.1.1 <a href="appendix#strings">Strings</a></li>
            <li>24.1.2 <a href="appendix#arrays">Arrays</a></li>
            <li>24.1.3 <a href="appendix#dictionaries">Dictionaries</a></li>
        </ol>
        </li>
        <li>24.2 <a href="appendix#indentation_rules">Indentation Rules</a>
        <ol>
            <li>24.2.1 <a href="appendix#introduction">Introduction</a></li>
            <li>24.2.2 <a href="appendix#the_system">The System</a></li>
            <li>24.2.3 <a href="appendix#increase_pattern">Increase Pattern</a></li>
            <li>24.2.4 <a href="appendix#decrease_pattern">Decrease Pattern</a></li>
            <li>24.2.5 <a href="appendix#increase_only_next_line">Increase Only Next Line</a></li>
            <li>24.2.6 <a href="appendix#ignoring_lines">Ignoring Lines</a></li>
        </ol>
        </li>
        <li>24.3 <a href="appendix#plug-in_api">Plug-in API</a></li>
</ol>
</li>
</ol>

		</div>

		<div class="chapter">
			<h1>1 Preface</h1>

<h2>1.1 About the Documentation</h2>

<p>The intended purpose of the documentation is to explain the main features of TextMate and to highlight features that may not be obvious to first time users. The documentation is not exhaustive.</p>

<p>You should have a good understanding of what a text editor is, in particular you should have some experience with Cocoa's text edit control (used in TextEdit, Mail and Xcode). While TextMate does not use that control, it does mimic its behavior for the most part.</p>

<p>If you want to print this documentation then <a href="all_pages.html">here is a printable version</a>.</p>

<h2>1.2 Philosophy of TextMate</h2>

<p>From UNIX we get that <em>Tasks and Trends Change.</em> In concrete terms this means that instead of writing a command (in UNIX) to solve the problem at hand, we find the underlying pattern, write a command to solve problems of that type and then use that command in a script.</p>

<p>This gives us a command which we can re-use in the future for multiple problems of the same type. Since it is generally much easier (and more flexible) to piece together a script of different commands than it is to write a specific command the increase in productivity can be very large. This is especially true since we do not actually write the command in the first place, we use an existing command that has already been written for this type of problem.</p>

<p>There are two ways in which TextMate leverages that philosophy. First it has good shell integration, so if you are skilled in using the UNIX shell, you should love TextMate.</p>

<p>But more ambitiously, TextMate tries to find the underlying patterns behind automating the tedious, being smart about what to do and then to provide you with the functionality so that you can combine it for your particular needs.</p>

<p>Granted, TextMate is not the first text editor which tries to be broad, but from Apple we get the venerable <em>Keep It Simple.</em> So even users with little or no experience with scripting and regular expressions are able to customize TextMate in ways that no other editor would have allowed them to.</p>

<p>Having said that, the philosophy of TextMate is also to <em>Educate the User.</em> So to fully capitalize on what TextMate gives you, you should learn about <a href="regular_expressions.html">regular expressions</a>, you should understand TextMate's <a href="scope_selectors.html">scope</a>, <a href="snippets.html">snippet</a> system (also <a href="language_grammars.html">language grammars</a> to some degree) and have an idea about the <a href="shell_commands.html">shell infrastructure</a> provided (in particular <a href="environment_variables.html">environment variables</a>, pipes and stdin/stdout).</p>

<h2>1.3 Terminology</h2>

<p>For the most part TextMate and this documentation abides by <a href="http://developer.apple.com/documentation/UserExperience/Conceptual/OSXHIGuidelines/XHIGText/chapter_13_section_3.html#//apple_ref/doc/uid/TP30000365-TPXREF101">Apples terminology</a>. Below is a table of terms that might be a source of misunderstanding.</p>

<table class="graybox" border="0" cellspacing="0" cellpadding="5">
    <tr>
        <th>Term</th>
        <th>Explanation</th>
    </tr>

    <tr>
        <td><p>Caret</p></td>
        <td><p>The text insertion point.</p></td>
    </tr>

    <tr>
        <td><p>Cursor</p></td>
        <td><p>Mouse pointer.</p></td>
    </tr>

    <tr>
        <td><p>Document</p></td>
        <td><p>This refers to a file when it is loaded into TextMate (for the purpose of being edited). Old-timers often refer to this as the <em>buffer</em>.</p></td>
    </tr>

    <tr>
        <td><p>Directory</p></td>
        <td><p>This is sometimes used instead of folder. Folder is mainly used when talking about the GUI and directory is used when talking about shell related things.</p></td>
    </tr>
</table>

<p>Generally TextMate and this documentation use the glyph representation of a key. Below is a table with most glyphs, the name of the key (as used in this documentation) and a short explanation.</p>

<p><img src='images/keyboard_viewer.png' width="376" height="147" alt="Keyboard Viewer" title=""></p>

<p>If you are unsure about the location of a key, you can bring up the <a href="http://docs.info.apple.com/article.html?path=mac/10.4/en/mh2325.html">Keyboard Viewer</a>, which you can add to the Input menu in the International pane of System Preferences.</p>

<table class="graybox" border="0" cellspacing="0" cellpadding="5">
    <tr>
        <th>Glyph</th>
        <th>Key Name</th>
        <th>Explanation</th>
    </tr>

    <tr>
        <td><p>&#x2303;</p></td>
        <td><p>Control</p></td>
        <td><p>This key is generally in the lower left corner of the keyboard (and symmetrically placed on the right side). In addition to key equivalents, this key is also used with a mouse click to bring up context sensitive menus.</p></td>
    </tr>

    <tr>
        <td><p>&#x2325;</p></td>
        <td><p>Option</p></td>
        <td><p>This is next to the control key and often bears the label Alt. You can hold down the option key while dragging with the mouse to select text rectangularly. It is also possible to place the caret beyond the end of a line by single-clicking the mouse while holding the down option key (&#x2325;). Together with Shift, the option key does a (rectangular) selection to where you click.</p></td>
    </tr>

    <tr>
        <td><p>&#x2318;</p></td>
        <td><p>Command</p></td>
        <td><p>The command key is also referred to as the Apple key since it has an apple symbol on it (&#63743;).</p></td>
    </tr>

    <tr>
        <td><p>&#x21E7;</p></td>
        <td><p>Shift</p></td>
        <td><p>The Shift key should be well-known. When used together with a mouse click, it extends the selection.</p></td>
    </tr>

    <tr>
        <td><p>&#x238B;</p></td>
        <td><p>Escape</p></td>
        <td><p>The escape key is generally in the upper left corner of the keyboard. This key can be used to dismiss (cancel) panels, which means dialogs and some (but not all) windows. In TextMate it is also used to cycle through completion candidates.</p></td>
    </tr>

    <tr>
        <td><p>&#x2305;</p></td>
        <td><p>Enter</p></td>
        <td><p>The enter key is on the numeric keypad (and is not the same as return). On laptops it is fn-return.</p></td>
    </tr>

    <tr>
        <td><p>&#x21A9;</p></td>
        <td><p>Return</p></td>
        <td><p>The return key should be well known.</p></td>
    </tr>

    <tr>
        <td><p>&#x2326;</p></td>
        <td><p>Forward&nbsp;Delete</p></td>
        <td><p>This is often just called delete and on the keyboard has a label of Del or Delete.</p></td>
    </tr>

    <tr>
        <td><p>&#x232B;</p></td>
        <td><p>Backward&nbsp;Delete</p></td>
        <td><p>Often called backspace. On most keyboards this has a left pointing arrow on the key (&#x2190;).</p></td>
    </tr>

    <tr>
        <td><p>&#xFE56;&#x20DD;</p></td>
        <td><p>Help</p></td>
        <td><p>The Help key is located above Forward Delete, but not all keyboards have it. Generally it has the word Help on the key, but it is also known as the Ins key.</p></td>
    </tr>

    <tr>
        <td><p>&#x2196;</p></td>
        <td><p>Home</p></td>
        <td><p>The Home key scrolls to the beginning of the document, but does not move the caret.</p></td>
    </tr>

    <tr>
        <td><p>&#x2198;</p></td>
        <td><p>End</p></td>
        <td><p>The End key scrolls to the end of the document, but does not move the caret.</p></td>
    </tr>

    <tr>
        <td><p>&#x21DE;</p></td>
        <td><p>Page&nbsp;Up</p></td>
        <td><p>Scrolls up a page without moving the caret. Using the option key will cause the caret to be moved. When used with Shift it will create a selection.</p></td>
    </tr>

    <tr>
        <td><p>&#x21DF;</p></td>
        <td><p>Page&nbsp;Down</p></td>
        <td><p>Scrolls down a page without moving the caret. Using the option key will cause the caret to be moved. When used with Shift it will create a selection.</p></td>
    </tr>

    <tr>
        <td><p>&#x21E5;</p></td>
        <td><p>Tab</p></td>
        <td><p>The Tab key is used to insert a tab character (or equivalent amount of spaces if soft tabs are enabled). In normal controls it advances the focus to the next control.</p></td>
    </tr>

    <tr>
        <td><p>&#x21E4;</p></td>
        <td><p>Back-tab</p></td>
        <td><p>The Back-tab key can be used by holding down Shift while pressing the normal Tab key.</p></td>
    </tr>
</table>

<h2>1.4 Limitations</h2>

<p>TextMate is a work-in-progress. One current key limitation (for non-Western users) is support for international input modes (e.g. CJK), proportional fonts, right-to-left text rendering and other (UniCode) features. As the author, I do understand the desire from users to have TextMate support these things, but currently proper support for this is a long-term to-do item.</p>

<p>And on the topic of limitations, I am also aware of the desire for (s)ftp integration, code hinting, split views, better printing, indented soft wrap, coffee making and literally hundreds of other user requests. You will be able to find my comments on most feature requests by <a href="getting_help#mailing_list.html">searching the mailing list</a> archive, but I do not give estimates or timeframes, other than what version number I plan for something to appear in.</p>

		</div>
		<div class="chapter">
			<h1>2 Working With Multiple Files</h1>

<h2>2.1 Creating Projects (With Tabs)</h2>

<p>In the current version of TextMate (1.5) file tabs are only supported when a project is created. Fortunately it is easy to create a project, namely by selecting File &#x2192; New Project (&#x2303;&#x2318;N).</p>

<p>This opens a window which looks like the one below.</p>

<p><img src='images/project_window.png' width="326" height="214" alt="Project Window" title=""></p>

<p>It is possible to add files either by dragging them to the (project) drawer, or use the “Add Existing Files…” action in the project drawers action menu (the one with the gear icon).</p>

<p>Another way to create a project is by dragging files directly onto the TextMate application icon (shown e.g. in the dock). This is a shortcut for creating a new project consisting of these files.</p>

<p>One minor detail is that when creating a project this way, you will not be asked if you want to save the project, when it is closed.</p>

<p>The advantage of saving a project is to maintain state (e.g. which files were open) and to be able to quickly re-open a particular set of files. If you leave a (saved) project open when you quit TextMate, it will automatically re-open that project the next time you launch TextMate.</p>

<p>It is also possible to <a href="using_textmate_from_terminal.html">create projects from the terminal</a> e.g. using the <code>mate</code> shell command.</p>

<h3>2.1.1 Auto-Updating Projects</h3>

<p>When you want to have your project mimic the files and folders on disk, you can drag a folder either onto the TextMate application icon, or into the project drawer.</p>

<p>TextMate will then create a <em>folder reference</em> where it automatically updates the contents of the folder when it changes on disk.</p>

<p><img src='images/project_window_with_tabs.png' width="330" height="226" alt="Project Window With Tabs" title=""></p>

<p>Currently updating is done when TextMate regains focus and can be slow for some network mounted disks, in which case you may want to settle for only adding individual files to the project (which can be grouped and re-ordered manually to mimic the structure on disk).</p>

<p><em>The refresh delay for network mounted disks will be addressed in a future release.</em></p>

<h3>2.1.2 Filtering Unwanted Files</h3>

<p>When using folder references, you may want to have certain files or folders excluded from the project. This can be done by changing the file and folder patterns found in Preferences &#x2192; Advanced &#x2192; Folder References.</p>

<p><img src='images/folder_reference_patterns.png' width="239" height="213" alt="Folder Reference Patterns" title=""></p>

<p>These are regular expressions which are matched against the full path of each file and folder. If the pattern does match the item, it is included, otherwise it is excluded. To reverse that, so that items which match are excluded from the project, prefix the pattern with an exclamation point (<code>!</code>).</p>

<p>The patterns are only used when creating new folder references. For existing folder references one can select the folder reference in the project drawer and use the info button (a circled letter I) in the project drawer to edit the patterns.</p>

<p><em>The complexity of this system will be addressed in a future release.</em></p>

<h3>2.1.3 Text and Binary Files</h3>

<p>You can either single or double click files in the project drawer. If you single click them and the file type is text, they open as a file tab in the main window.</p>

<p><img src='images/tab_bar.png' width="400" height="23" alt="Tab Bar" title=""></p>

<p>If you double click a file, it will open using the default application. Note that folders can also be double clicked e.g. Interface Builder’s nib files will appear as folders, but can still be double clicked (and will then open in Interface Builder).</p>

<p>As mentioned, only text files will open in the main window when single clicked. The way TextMate determines if a file is text is by its extension - if the extension is unknown it scans the first 8 KB of the file to see if it is valid UTF-8 (which is a superset of ASCII).</p>

<p>If TextMate does not open your file and it does have an extension you can bring up the action menu for that file and pick the last item, which should read: <em>Treat Files With “.«ext»” Extension as Text</em>.</p>

<h3>2.1.4 Positioning the Project Drawer</h3>

<p>The project drawer will by default open on the left side of the project window. If there is no room for it to open there, it will use the right side instead. This setting is sticky so will remember which side the project drawer was last opened on.</p>

<p><img src='images/project_drawer.png' width="70" height="125" alt="Project Drawer" title=""></p>

<p>To move it back to the left side you need to close the drawer (View &#x2192; Hide Project Drawer) and then move the project window so that there is no longer room for the drawer on its right. When you then re-open the drawer, it will again appear on the left side and use that as the new default.</p>

<p>The opposite can be done to force it to open on the right side.</p>

<h2>2.2 Find and Replace in Projects</h2>

<p>Using Edit &#x2192; Find &#x2192; Find in Project… (&#x21E7;&#x2318;F) will bring up the window shown below.</p>

<p><img src='images/find_in_project.png' width="265" height="203" alt="Find In Project" title=""></p>

<p>From here it is possible to search all (text) files in the current project and do replacements. After pressing Find it is possible to either press Replace All, or select which matches should be replaced, in which case the Replace All button will change to Replace Selected.</p>

<p>Currently it is not possible to limit the scope of the search to anything other than all text files in the full project. As a workaround, when you want to search only a subset of your project, you can select the files you want to search in the project drawer and drag the selection to the TextMate application icon to create a new scratch project. A find/replace can then be performed on that project, which can then be closed.</p>

<h2>2.3 Moving Between Files (With Grace)</h2>

<p>When working with projects there are a few ways to move between the open files.</p>

<p>The most straightforward way is by clicking on the file tab you need. This can also be done from the keyboard by pressing &#x2318;1-9, which will switch to file tab 1-9.</p>

<p>You can also use &#x2325;&#x2318;&#x2190; and &#x2325;&#x2318;&#x2192; to select the file tab to the left or right of the current one.</p>

<p>It is possible to re-arrange the file tabs by using the mouse to drag-sort them (click and hold the mouse button on a tab and then drag it to the new location). This should make it possible to arrange them so that keyboard switching is more natural.</p>

<p>One more key is &#x2325;&#x2318;&#x2191; which cycles through text files with the same base name as the current file. This is mainly useful when working with languages which have an interface file (header) and implementation file (source).</p>

<p>When you want to move to a file which is not open you can use the Go to File… action in the Navigation menu (bound to &#x2318;T). This opens a window like the one shown below.</p>

<p><img src='images/go_to_file.png' width="247" height="284" alt="Go To File" title=""></p>

<p>This window lists all text files in the project sorted by last use, which means pressing return will open (or go to) the last file you worked on. So using it this way makes for easy switching to the most recently used file.</p>

<p>You can enter a filter string to narrow down the number of files shown. This filter string is matched against the filenames as an abbreviation and the files are sorted according to how well they match the given abbreviation. For example in the picture above the filter string is <code>otv</code> and TextMate determines that <code>OakTextView.h</code> is the best match for that (by placing it at the top).</p>

<p>The file I want is <code>OakTextView.mm</code> which ranks as #2. But since I have already corrected it in the past, TextMate has learned that this is the match that should go together with the <code>otv</code> filter string, i.e. it is adaptive and learns from your usage patterns.</p>

		</div>
		<div class="chapter">
			<h1>3 Navigation / Overview</h1>

<h2>3.1 Bookmarks</h2>

<p>If you need to move the caret to somewhere else in your document and want a quick way to return, you can place a bookmark on the current line.</p>

<p>This is done either by clicking in the gutter (in the column dedicated to bookmarks) or pressing &#x2318;F2. The bookmark will be indicated with a star as shown below.</p>

<p><img src='images/bookmark.png' width="99" height="136" alt="Bookmark" title=""></p>

<p>When you want to return you can press F2, which moves you to the next bookmark in the document. If there is more than one bookmark, you can press F2 repeatedly. &#x21E7;F2 will move to previous bookmark.</p>

<h2>3.2 Collapsing Text Blocks (Foldings)</h2>

<p>When working in a language which has start/end markers for blocks, like <code>{</code> … <code>}</code>, <code>do</code> … <code>end</code>, <code>&lt;tag&gt;</code> … <code>&lt;/tag&gt;</code> and similar, TextMate can spot these blocks and will show up/down arrows in the gutter beside the start/end marker.</p>

<p>When these arrows are present, it is possible to fold the block into a single line either by using the mouse and clicking on the up/down arrow, or pressing the F1 key. This will make the arrow in the gutter point to the right and indicate that the entire block was folded by placing an ellipsis marker at the end of the line. An example where the two sub-blocks of the constructor has been folded can be seen below.</p>

<p><img src='images/folded_blocks.png' width="478" height="136" alt="Folded Blocks" title=""></p>

<p>With text folded, it is possible to unfold it with F1 or clicking either the arrow in the gutter or the ellipsis image. It is also possible to hover the mouse pointer on the ellipsis image to get a tool tip which shows the contents of the folded block. The latter is shown on the following picture.</p>

<p><img src='images/folding_tool_tip.png' width="291" height="155" alt="Folding Tool Tip" title=""></p>

<p><em>A word of caution: the folding system is based on both having clear indent markers <strong>and</strong> having the fold start/stop markers use the same indent level. This means that folding based purely on indent or where the start/stop markers do not align, is currently not supported.</em></p>

<h3>3.2.1 Customizing Foldings</h3>

<p>As mentioned the folding system uses explicitly defined start and stop markers. TextMate knows about these from the <a href="language_grammars.html">language grammar</a> where you can setup a <code>foldingStartMarker</code> and <code>foldingStopMarker</code> regular expression.</p>

<p><img src='images/folding_patterns.png' width="381" height="186" alt="Folding Patterns" title=""></p>

<p>Shown above are the HTML folding patterns, which are all relatively simple because they fold on a selected set of tag pairs, HTML comments, some Smarty tags and start/stop braces when either last on the line or used in embedded code tags like this:</p>

<pre><code>&lt;?php if(something) { // user is authenticated ?&gt;

   ...

&lt;?php } // user is authenticated ?&gt;
</code></pre>

<p>To define a block that starts with <code>{</code> as the last non-space character on the line and stops with <code>}</code> as the first non-space character on the line, we can use the following patterns:</p>

<pre><code>foldingStartMarker = '\{\s*$';
foldingStopMarker = '^\s*\}';
</code></pre>

<h2>3.3 Function Pop-up</h2>

<p>For languages that support it, the rightmost pop-up in the status bar shows the current “symbol” (often the function prototype or heading above the caret).</p>

<p><img src='images/status_bar.png' width="421" height="13" alt="Status Bar" title=""></p>

<p>It is possible to click on the pop-up to get a list of all the symbols in the current document and move the caret to one of these. This is shown below.</p>

<p><img src='images/function_pop_up.png' width="153" height="94" alt="Function Pop Up" title=""></p>

<p>For keyboard navigation there is also Navigation &#x2192; Go to Symbol… (&#x21E7;&#x2318;T) which opens a panel like the one shown below. The contents of this pane are the same as the pop-up from the status bar but this panel supports filtering similar to the <a href="working_with_multiple_files#moving_between_files_with_grace.html">Go to File… panel</a> (i.e. where the filter string is treated as an abbreviation and matches are ranked according to how good a fit the abbreviation seems to be).</p>

<p><img src='images/symbol_list.png' width="171" height="270" alt="Symbol List" title=""></p>

<p>The panel can be left open and will automatically update as the document is edited. If you single-click an item in the list, the caret will move to the symbol clicked. Double-clicking will do the same but also closes the panel.</p>

<h3>3.3.1 Customizing the List</h3>

<p>The symbol list works using <a href="language_grammars.html">language grammars</a> and <a href="scope_selectors.html">scope selectors</a>. A language grammar assigns names to each element in the document and a scope selector is capable of targeting a subset of the document based on these names. Normally the parallel is HTML and CSS, e.g. we can make a <a href="themes.html">theme item</a> which sets the background to blue and then use the scope selector to pick which elements in our document we want this theme (and hence the blue background) applied to.</p>

<p><a href="preferences_items.html">Bundle preferences</a> work like theme items, except that instead of changing visual settings they (generally) change non-visual settings. One exception is the <code>showInSymbolList</code>. By setting this to <code>1</code> and using a scope selector which (for example) targets all function names, we are using that scope selector as a query to extract all the function names from the document, for use in the symbol list.</p>

<p>So to populate the symbol list we need to:</p>

<ol>
<li><p>Make sure the language grammar assigns a name to what we want to show.</p></li>
<li><p>Create a bundle preferences item that sets <code>showInSymbolList</code> to <code>1</code> and uses a scope selector that matches the symbols we want to have in the symbol list.</p></li>
</ol>

<p>In addition to the <code>showInSymbolList</code> setting there is a <code>symbolTransformation</code> setting which is one or more regular expression substitutions which are performed on the text extracted. The value of this setting should be: <code>s/«regexp»/«format»/«options»</code> optionally followed by <code>;</code> and more substitutions. It is also possible to put comments in the value, these start with <code>#</code> and end at the next newline.</p>

<p>So if we want to show Markdown headings in the list, which are lines that start with one or more <code>#</code> marks, then we first make sure our <a href="language_grammars.html">language grammar</a> assigns a name to these, for Markdown that can be identified with this rule, by specifying the following in the language grammar:</p>

<pre><code>{  name = 'markup.heading.markdown';
   match = '^#{1,9}\s*(.*)$';
},
</code></pre>

<p>Now we can target all headings using a scope selector of <code>markup.heading.markdown</code>. We can now create a bundle preferences item that is simply:</p>

<pre><code>{  showInSymbolList = 1;   }
</code></pre>

<p>This will include the leading <code>#</code> marks in the list, which is undesirable. We can either assign a name (via the language grammar) to the actual title, or we can perform a regular expression substitution to get rid of the leading <code>#</code> marks. The latter has the advantage that we can change these to indent, so that is what we do, by changing the preferences item to:</p>

<pre><code>{  showInSymbolList = 1;
   symbolTransformation = '
      s/(?&lt;=#)#/ /g;          # change all but first # to m-space
      s/^#( *)\s+(.*)/$1$2/;  # strip first # and space before title
   ';
}
</code></pre>

		</div>
		<div class="chapter">
			<h1>4 Working With Text</h1>

<p>TextMate tries for the most part to mimic the behavior of the <code>NSTextView</code> system component, as used by applications such as Mail, Safari and basically all other Cocoa applications.</p>

<p>Some of the extra features related to text editing are covered in this section.</p>

<h2>4.1 Auto-Paired Characters (Quotes etc.)</h2>

<p>When writing structured text (like markup or source code) there are characters which go together in pairs. For example in a programming language you rarely type an opening brace (<code>{</code>) without also needing the closing brace (<code>}</code>).</p>

<p>To help you keep these characters balanced, TextMate will insert the appropriate closing character after the caret when you type the opening one. If you type the closing character TextMate is smart enough to overwrite the auto-inserted one. If you type an opening character and then delete it using backward delete (&#x232B;) then the auto-inserted character will also be deleted. If you only want to delete the auto-inserted character, use forward delete instead (&#x2326;).</p>

<p>It is also possible to wrap a selection in an open/close character by selecting text and typing the opening character. For example if you type <code>foo</code>, select it and type <code>(</code> then TextMate will make it <code>(foo)</code> placing the caret after the ending parentheses.</p>

<p>The actual character pairs are defined in the <a href="preferences_items#paired_characters.html">bundle preferences</a> with different settings for different languages and contexts. For example, in source code an apostrophe is set up to have itself as a closing character, except for comments and strings. This is achieved using <a href="scope_selectors.html">scope selectors</a>.</p>

<p>Two useful shortcuts in relation to auto-paired characters (defined as macros in the <a href="bundles#source.html">Source bundle</a> and overridden for a few languages) are:</p>

<ol>
<li><p>&#x2318;&#x21A9; <br>
Move to the end of the line and insert a newline. <br>
For example if you write:</p>

<pre><code>print("foo
</code></pre>

<p>Then you will have <code>")</code> to the right of the caret and can now use &#x2318;&#x21A9; to skip these two characters and insert a new line.</p></li>
<li><p>&#x21E7;&#x2318;&#x21A9; <br>
Move to the end of the line, insert a <code>;</code> and then insert a newline.</p></li>
</ol>

<h2>4.2 Completion</h2>

<p>TextMate has a simple yet effective completion function on &#x238B;
(escape). It will complete the current word based on matches in the current document. If there are multiple matches, you can cycle through these by pressing &#x238B; continuously. It is also possible to cycle backwards using &#x21E7;&#x238B;.</p>

<p>The matches are sorted by distance from the caret, meaning candidates which are closer to the caret will be suggested before candidates farther away.</p>

<p>Two possibilities exist for augmenting this default completion. Both are done via <a href="preferences_items#completions.html">bundle preferences</a>.</p>

<p>The first option is to provide a list of candidates which should always be suggested. For example the Objective-C bundle has a list of commonly used Cocoa framework methods. This is an array of the candidates, e.g.:</p>

<pre><code>completions = ( 'retain', 'release', 'autorelease', 'description' );
</code></pre>

<p>The other option is to set a custom shell command to gather the completions. The shell command will have the <code>TM_CURRENT_WORD</code> <a href="environment_variables.html">environment variable</a> available (as the word which needs to be completed) along with the other variables.</p>

<p>For example the C bundle has a custom completion command setup for when the caret is inside the preprocessor include directive, it looks like this:</p>

<pre><code>completionCommand = 'find "$TM_DIRECTORY" \
    -name "$TM_CURRENT_WORD*.h" -maxdepth 2 \
    -exec basename "{}" \;|sort';
</code></pre>

<p>This will find as matches, any file in the current directory (and direct sub-directories) which have the current word as prefix and an <code>.h</code> extension.</p>

<p>When you provide your own completion command (or list) you may want to disable the default matches. This can be done by setting <code>disableDefaultCompletion</code> to <code>1</code>.</p>

<h2>4.3 Copy and Paste</h2>

<h3>4.3.1 Clipboard History</h3>

<p>Each time you copy or cut text, the text is pushed onto a stack.</p>

<p>By pressing &#x2303;&#x2325;&#x2318;V you will see the list of all previous clippings and can pick the one you want to paste using arrow keys. Use return to insert it and escape to dismiss the list. If you dismiss the list, the currently selected clipping will be what gets pasted the next time you use the paste function.</p>

<p><img src='images/clipboard_history.png' width="144" height="89" alt="Clipboard History" title=""></p>

<p>Instead of having to pick the clip from the list, you can use &#x21E7;&#x2318;V to paste the previous clip in the list. Using that key again will advance to the clip before that and so on. To go back you can use &#x2325;&#x2318;V. These key equivalents are useful when you want to make multiple copies from one document and then paste these LIFO-style (Last In First Out) into another document (or another location in the same document).</p>

<h3>4.3.2 Re-indented Paste</h3>

<p>When pasting text, TextMate will estimate the indent of the text pasted as well as the current indent level and adjust the pasted text so that it matches the current indent.</p>

<p>The estimates are done using the indentation rules mentioned in the <a href="working_with_text#re-indent_text.html">Re-Indent Text</a> section.</p>

<p>If you temporarily want to avoid this you can paste text using &#x2303;&#x2318;V. You can also permanently disable re-indented pasting in the Text Editing part of the Preferences.</p>

<h2>4.4 Editing Modes</h2>

<h3>4.4.1 Freehanded Editing</h3>

<p>You can enable or disable freehanded editing in the Edit &#x2192; Mode submenu (&#x2325;&#x2318;E). </p>

<p>With this mode enabled caret movement will not be restricted by line endings or tab stops.</p>

<p>This is useful when working with ASCII diagrams, when inserting something at a given column on several lines (and you do not want to insert the padding) and in a few other situations.</p>

<p>When making <a href="working_with_text#column_selections.html">column selections</a> freehanded mode is (temporarily) enabled, allowing you to make selections past the end of lines.</p>

<p>It is also possible to place the caret beyond the end of a line by single-clicking the mouse while holding down the option key (&#x2325;).</p>

<h3>4.4.2 Overwrite Mode</h3>

<p>By enabling overwrite mode in the Edit &#x2192; Mode submenu (&#x2325;&#x2318;O) characters already in the document will be overwritten as you type rather than inserted as normal.</p>

<p>This is useful when working with column data, e.g.:</p>

<pre><code>foo     jaz
bar     sub
fud     dub
</code></pre>

<p>Imagine we want to overwrite some of the values in the first column. Somewhat similarly, we may have a line of a fixed width and want to replace part of it but preserve the width, for example we could have code like this where we must right-align the value to column 20 but want to overwrite the label:</p>

<pre><code>printf("Value is         %3d", 37).
</code></pre>

<h2>4.5 Find and Replace</h2>

<p>In addition to the standard find dialog, TextMate has a Find submenu (located in the Edit menu) which gives you key equivalents for find and replace actions.</p>

<p><img src='images/find_menu.png' width="174" height="162" alt="Find Menu" title=""></p>

<h3>4.5.1 Inserting Newlines and Tabs in the Find Dialog</h3>

<p>The find dialog uses normal system controls for accepting input. You can toggle between single line and multi line text controls using the arrow next to the Replace text field.</p>

<p><img src='images/multi_line_find_dialog.png' width="451" height="270" alt="Multi Line Find Dialog" title=""></p>

<p>If you need to insert a newline or tab character into either of the text fields, you can hold down option (&#x2325;) while pressing the tab (&#x21E5;) or return (&#x21A9;) key. This will insert a literal tab or newline character.</p>

<h3>4.5.2 Find Clipboard</h3>

<p>Two useful key equivalents are &#x2318;E and &#x2318;G. The first copies the selection to the shared find clipboard. This works in the majority of applications and allows you to find the next occurrence of that string by then pressing &#x2318;G.</p>

<p>The find clipboard works across applications so whether in Safari, TextEdit, Mail, TextMate, Terminal, Console, or similar, one can copy the selected text to the find clipboard, switch application and use &#x2318;G to find that string.</p>

<p>In addition TextMate offers &#x21E7;&#x2318;E to copy the selection to the replace clipboard. This is often useful to save a trip to the find dialog, for example if you want to replace newlines with the pipe character (<code>|</code>) for a list of items, select a newline, press &#x2318;E to use that as the find string. Now type a <code>|</code>, select it and press &#x21E7;&#x2318;E so that it is copied to the replace clipboard.</p>

<p>The next step is then to either press &#x2303;&#x2318;F to perform the replacement in the entire document, or select the range in which you want the replacement to occur and use &#x2303;&#x21E7;&#x2318;F instead.</p>

<h2>4.6 Moving Text</h2>

<h3>4.6.1 Increase/Decrease Indent Level</h3>

<p>In the Text menu there is a Shift Left and Shift Right action bound to &#x2318;[ and &#x2318;]. These will increase and decrease the indent by the size of one tab.</p>

<p>On many european key layouts these keys are rather awkward, so in addition to these, you can also use &#x2325;&#x21E5; and &#x2325;&#x21E4; (where &#x21E4; is achieved using &#x21E7;&#x21E5;).</p>

<h3>4.6.2 Move Text Up/Down/Left/Right</h3>

<p>If you want to move a line/block up/down a few lines or move a word/column selection, it can be done by holding down &#x2303;&#x2318; and using the arrow keys to move the selection around. It also works for moving lines up/down without a selection.</p>

<h3>4.6.3 Re-indent Text</h3>

<p>If you have code which has broken indent, you can select it and use Text &#x2192; Indent Selection (without a selection it indents the current line).</p>

<p>The rules for estimating the indent are setup per-language using <a href="preferences_items.html">bundle preferences</a>. For more details see the <a href="appendix#indentation_rules.html">indentation rules section</a>.</p>

<h2>4.7 Selecting Text</h2>

<p>Selecting text is achieved by holding down &#x21E7; while using the normal movement keys. In addition the Edit &#x2192; Select submenu has actions to select current word, line, paragraph, enclosing brackets and entire document.</p>

<h3>4.7.1 Editing Multiple Lines</h3>

<p>Sometimes there is a need for adding a suffix to lines of variable length, or maybe editing the last part of these lines.</p>

<p>Although you can use find and replace for this, an easier way is to select the lines that needs to be edited, then use Text &#x2192; Edit Each Line in Selection (&#x2325;&#x2318;A) and the caret will be placed at the end of the first line in the selection.</p>

<p>You can now type new text, delete text or go back and edit existing text and this will be mirrored down through all the (previously selected) lines. To leave this mode, simply move the caret away from the current line.</p>

<h3>4.7.2 Column Selections</h3>

<p>It is possible to select column data either by holding down &#x2325; and making the selection with the mouse, or making a regular selection and then pressing &#x2325; once (which toggles between the two types of selection).</p>

<p>You can use all the normal actions on a column selection e.g. move selection, replace in selection, transpose (lines),  actions from the Text menu, filter the selection through a shell command, etc.</p>

<h2>4.8 Column Movement / Typing</h2>

<p>Using arrow up/down with &#x2325; will move the caret to the first/last row in the current column. Hold down &#x21E7; to get it selected.</p>

<p><img src='images/column_data.png' width="86" height="53" alt="Column Data" title=""></p>

<p>For example if you have column data as shown above with the caret in front of <code>foo</code>, press &#x2325;&#x21E7;&#x2193; and it will move the caret down in front of <code>fud</code> and leave the text between <code>foo</code> and <code>fud</code> selected.</p>

<p><img src='images/column_movement.png' width="86" height="53" alt="Column Movement" title=""></p>

<p>You may now either want to press &#x2325; once to switch to a zero-width column selection, then start typing to type on each line.</p>

<p><img src='images/column_typing.png' width="86" height="53" alt="Column Typing" title=""></p>

<p>Alternatively use &#x2325;&#x21E7;&#x2192; and then &#x2325; to leave the entire column selected (in column mode).</p>

<p><img src='images/column_selection.png' width="86" height="53" alt="Column Selection" title=""></p>

<h2>4.9 Smart Tab Behavior</h2>

<p>When using the tab key at the beginning of a line, TextMate will insert as many tabs as it estimates to be correct for that line. If the line already has text the caret will move to the front of this text.</p>

<p>If the line already has the correct indent (or above) a single tab will be inserted.</p>

<h2>4.10 Spell Checking</h2>

<p>TextMate supports the system wide 'Check Spelling as You Type'. This can be changed in the Edit &#x2192; Spelling submenu.</p>

<p>You can bring up the context sensitive menu for a misspelled word to get spelling suggestions.</p>

<p>Since TextMate is intended for structured text it is possible to exclude parts of the document from being checked. This is done by creating a <a href="preferences_items.html">preferences item</a> in the bundle editor, setting <code>spellChecking</code> to <code>0</code> and filling in the <a href="scope_selectors.html">scope selector</a> with the selector to target for no spell checking.</p>

<p>By default spell checking is disabled for source code except strings and comments and also for keywords, tags and similar in HTML, LaTeX, Markdown, etc.</p>

<h2>4.11 Using Spaces Instead of Tabs</h2>

<p>TextMate can use spaces instead of tab characters. This is done by clicking the “Tab Size” pop-up in the status bar and enabling Soft Tabs.</p>

<p>This setting will only affect the current language and all languages with a common root that do not have the option set yet. The same applies to the state of spell checking, soft wrap and the actual tab size.</p>

<p><img src='images/tab_size_settings.png' width="99" height="94" alt="Tab Size Settings" title=""></p>

<p>When soft tabs are enabled, TextMate will for the most part act exactly as if you were using hard tabs but the document does indeed contain spaces.</p>

		</div>
		<div class="chapter">
			<h1>5 Bundles</h1>

<p>A lot of functionality in TextMate is provided through various bundles, many of which are language specific.</p>

<p>The default bundles are located in <code>/path/to/TextMate.app/Contents/SharedSupport/Bundles</code>. Normally you do not need to care about this, as you inspect (and edit) the bundles through the bundle editor (which can be reached through the Window menu).</p>

<h2>5.1 Activation of Bundle Items</h2>

<p>If you select Bundles &#x2192; Bundle Editor &#x2192; Show Bundle Editor you will see the command center for customizing TextMate.</p>

<p><img src='images/bundle_editor.png' width="281" height="202" alt="Bundle Editor" title=""></p>

<p>From this window you can create and edit things like snippets, commands, language grammars, etc. which will be explained in more detail in the following sections.</p>

<p>Most items edited in the Bundle Editor represent actions you want to execute while editing text. TextMate offers a few ways to do this and has a simple yet powerful system to understand the current context when evaluating which action the activation method should result in, called <a href="scope_selectors.html">scope selectors</a>, which is explained in a later chapter.</p>

<h3>5.1.1 Key Equivalents</h3>

<p>The easiest way to perform an action (from the keyboard) is in the form of a key equivalent. A key equivalent can be any key with optional modifiers and is configured by activating the key equivalent field and pressing the key to which the item should be bound.</p>

<p><img src='images/key_equivalent.png' width="149" height="40" alt="Key Equivalent" title=""></p>

<p>If you want to disassociate a key equivalent with an item, press the X shown while the key equivalent field is in <em>recording</em> mode.</p>

<p>If multiple items are given the same key equivalent then a menu will appear when that key equivalent is pressed, as shown below (all of the items in the Math bundle are bound to &#x2303;&#x21E7;C so a menu with each key equivalent option is displayed).</p>

<p><img src='images/key_equivalent_ambiguity.png' width="216" height="81" alt="Key Equivalent Ambiguity" title=""></p>

<h3>5.1.2 Tab Triggers</h3>

<p>As well as assigning a single key equivalent to a bundle item, it is possible to assign a <em>tab trigger</em> to the item. This is a sequence of text that you enter in the document and follow it by pressing the tab key (&#x21E5;). This will remove the sequence entered and then execute the bundle item.</p>

<p>For example the Text bundle has a snippet which inserts the current date conforming to ISO 8601 (YYYY-MM-DD). The tab trigger for this snippet is <code>isoD</code> (short for ISO Date). In your document it is thus possible to type <code>isoD</code> and press tab to “expand” that to the current date.</p>

<p>This allows you to create much better mnemonics for your bundle items as you can literally type the thing you want to execute (e.g. the snippet to insert). It is generally a good idea to use actual words instead of abbreviations (like use <code>list</code> instead of <code>lst</code>) since the purpose is to make it easier to remember, so the tab trigger should generally be the first thing that pops into your mind in the unabbreviated form.</p>

<p>Tab triggers are rendered in the right side of the menu item with a slightly rounded rectangle as background and the tab character (&#x21E5;) shown as a suffix to the tab trigger.</p>

<p><img src='images/tab_trigger_menu.png' width="321" height="259" alt="Tab Trigger Menu" title=""></p>

<p>Tab triggers are also useful when they match program keywords and lead to actions (such as inserting snippets) that do what you would normally do after entering the keyword. For example in Ruby a method starts with <code>def</code> so creating a snippet for a Ruby method and assigning it <code>def</code> as tab trigger gives a natural flow, as you would write <code>def</code> as usual and then use tab instead of taking the normal actions. Had the tab trigger for a method (in Ruby) instead been <code>method</code> or similar, it means you would have to remember “I can insert a snippet for this” before typing <code>def</code>, whereas with <code>def</code> as the tab trigger, you have to remember it before pressing the space after <code>def</code> (basically just pressing tab instead of space).</p>

<p>As with key equivalents, entering a tab trigger and pressing tab will show a menu, when multiple items share the same tab trigger. This can be used to provide a simple form of code-completion, for example in CSS the tab trigger <code>list</code> has been assigned to all properties that start with list. So in CSS typing <code>list</code> followed by tab will give a useful menu from where you can pick what list property needs to be inserted.</p>

<p><img src='images/tab_trigger_ambiguity.png' width="182" height="103" alt="Tab Trigger Ambiguity" title=""></p>

<h2>5.2 Editing Default Bundles / Items</h2>

<p>Some of the default items may not be to your exact liking, for example the coding style in snippets may differ from yours, so you may want other tab triggers, key equivalents, or similar modifications.</p>

<p>If you edit a default item the difference will be stored in <code>~/Library/Application Support/TextMate/Bundles</code>. These are then merged with the default version so your changes will be effective even after upgrading TextMate. All new items you create also end up in this location.</p>

<p>Bundles or bundle items which you install by dragging them to TextMate or double clicking will be installed in <code>~/Library/Application Support/TextMate/Pristine Copy/Bundles</code>. Editing these will also result in only the differences being stored in <code>~/Library/Application Support/TextMate/Bundles</code>, meaning that if you later get a new version of this third party bundle, you can safely install this one on top of the old one (by dragging it to TextMate) and again your changes will be preserved.</p>

<p>If you want to discard local changes then currently the only option is to delete these from <code>~/Library/Application Support/TextMate/Bundles</code>.</p>

<h2>5.3 Deleting Default Bundles / Items</h2>

<p>You can also transparently delete default bundles and bundle items from the bundle editor. However, since the items are shipped with the TextMate application, they are not removed on disk, since they would then reappear after an upgrade.</p>

<p>Instead each bundle has an <code>info.plist</code> file which keeps the ordering of bundle items and also stores which of the default items should act as if they have been deleted. When you change the ordering of items in a default bundle or delete items, this file is copied to <code>~/Library/Application Support/TextMate/Bundles/«bundle name».tmbundle</code> and will contain this info.</p>

<p>If you delete an entire bundle the information is recorded in TextMate’s preferences. You can get a list of which default bundles have been deleted by running the following line in terminal:</p>

<pre><code>defaults read com.macromates.textmate OakBundleManagerDeletedBundles
</code></pre>

<p>To reset the list of deleted bundles (i.e. undelete them) instead run this (while TextMate is not running):</p>

<pre><code>defaults delete com.macromates.textmate OakBundleManagerDeletedBundles
</code></pre>

<p>This may all sound a little complicated, but generally you should not care about these details. Just use the bundle editor to create, edit and delete your items and bundles and it should work as expected.</p>

<h2>5.4 Hiding Bundles</h2>

<p>Instead of deleting default bundles you may want to just hide them (since you never know if you someday will need some of the default ones).</p>

<p>This is done by clicking the Filter List… button below the list in the bundle editor. Here you can uncheck the bundles that you do not wish to have shown in the various lists of bundle items.</p>

<p><img src='images/hiding_bundles.png' width="162" height="225" alt="Hiding Bundles" title=""></p>

<h2>5.5 Sharing Bundles and Bundle Items</h2>

<p>If you want to share a bundle or particular bundle item then you can drag it directly from the bundle editor (from the list in the left side of the window) to the Finder.</p>

<p>This item can then be sent to other people and they will be able to double-click it to install it. Note: this also works for single items, like a snippet or a command.</p>

<h2>5.6 Assorted Bundles</h2>

<p>Often a bundle will provide support for a particular language (though there are exceptions like the Source, Text and TextMate bundles). To get a good idea of what features the bundle provides, it is best to investigate it in the bundle editor (accessible from the Windows menu). When appropriate, a language bundle should provide the following, with key bindings as shown:</p>

<ul>
<li><p><em>Build</em> (&#x2318;B) — build the current source/project. Normally that means compile it.</p></li>
<li><p><em>Run</em> (&#x2318;R) — run the current source (script) or product from building a project.</p></li>
<li><p><em>Documentation for Word</em> (&#x2303;H) — lookup the current word (or “unit”) in the documentation (often online).</p></li>
<li><p><em>Validate Syntax</em> (&#x2303;&#x21E7;V) — run the syntax through whatever form of syntax checker exist for the current document type. Generally show errors as a tool tip, but for more complex validation, HTML output is sometimes used.</p></li>
<li><p><em>Wrap in «Something»</em> (&#x2303;&#x21E7;W) — wrap the selection in what makes sense for the current document type, e.g. open/close tags in HTML, begin/end environment in LaTeX.</p></li>
<li><p><em>Convert to «Something»</em> (&#x2303;&#x21E7;H) — convert the document into something which makes sense, e.g. for HTML run it through tidy, for Markdown convert it to HTML, for an XML property list convert it to the more readable ASCII version, etc. Generally this is done in-place, overwriting the current document.</p></li>
<li><p><em>Continue «Something»</em> (&#x2305;) — continue the current construct on the next line e.g. a line comment, list item or similar.</p></li>
<li><p><em>Preview Document</em> (&#x2303;&#x2325;&#x2318;P) — by default this opens the Web Preview, but it has been overloaded for some markup languages for a preview more suited for that language (i.e. doing the HTML conversion and setting up a basic style sheet before showing it).</p></li>
<li><p><em>Insert Close Element</em> (&#x2325;&#x2318;.) — by default this inserts the appropriate closing tag (HTML) but is overloaded in some contexts to insert whatever constitutes a close element (e.g. <code>\end{environment}</code> in LaTeX).</p></li>
<li><p><em>Comment Toggle</em> (&#x2318;/) — toggle comment characters around the current line or selection.</p></li>
</ul>

<p>Many bundles also have a Help command with some details about how to use and customize its functionality.</p>

<p>Bundle actions can be accessed through the gear pop-up in the status bar. This menu can also be brought up by pressing &#x2303;&#x238B;.</p>

<p><img src='images/bundle_actions.png' width="51" height="25" alt="Bundle Actions" title=""></p>

<p>Below are a few highlights from miscellaneous bundles.</p>

<h3>5.6.1 Diff</h3>

<p>The Diff bundle provides a <a href="language_grammars.html">language grammar</a> for the output produced by the <a href="http://developer.apple.com/documentation/Darwin/Reference/ManPages/man1/diff.1.html"><code>diff</code></a> shell command.</p>

<p>You can show the differences between two files in TextMate by running the following command from your terminal:</p>

<pre><code>diff -u old_file new_file|mate
</code></pre>

<p>The bundle also has commands to show the differences between the current document and the saved copy, between the selected files in the project drawer (with an HTML output option) and it has a command to open the selected files in Apple's FileMerge using <a href="http://developer.apple.com/documentation/Darwin/Reference/ManPages/man1/opendiff.1.html"><code>opendiff</code></a> (requires the developer tools to be installed).</p>

<h3>5.6.2 HTML</h3>

<p>The HTML bundle contains useful stuff for working with HTML. A few particularly useful actions are:</p>

<ul>
<li><p><em>Insert Open/Close Tag</em> (&#x2303;&lt;) — this command will take the word just typed and change it into <code>&lt;word&gt;&lt;/word&gt;</code> placing the caret in the middle. It will recognize those tags where a close tag is not allowed (like <code>hr</code>) and instead insert <code>&lt;word&gt;</code> placing the caret after the tag.</p></li>
<li><p><em>Wrap Selection in Open/Close Tag</em> (&#x2303;&#x21E7;W) — this will put <code>&lt;p&gt;…&lt;/p&gt;</code> around the selection but allows you to overtype the <code>p</code> (and add arguments). After you are done, press tab to move the caret past the <code>&lt;/p&gt;</code> tag.</p></li>
<li><p><em>Wrap Selection as Link</em> (&#x2303;&#x21E7;L) — this turns the selection into link text for an anchor where you can then fill in the URL.</p></li>
</ul>

<p>The HTML bundle also has a drag command for images which insert the dropped image with proper dimensions (width/height) and an alternative text derived from the file name.</p>

<p>A lot of actions in the HTML bundle will cause tags to be inserted. E.g. pressing ⌃↩ inserts <code>&lt;br&gt;</code>, dropping an image on a HTML document inserts <code>&lt;img …&gt;</code>, etc.</p>

<p>If you want tags with an EMPTY content model to use the minimized (XHTML) form (that is <code>&lt;br /&gt;</code> instead of <code>&lt;br&gt;</code>) then in <em>Preferences</em> → <em>Advanced</em> create a new variable named <code>TM_XHTML</code> and set it to ‘<code> /</code>’ (the value of this variable will be inserted before the <code>&gt;</code> in the generated tags with EMPTY content model).</p>

<p>For the records have a look at <a href="http://www.hixie.ch/advocacy/xhtml">Sending XHTML as text/html Considered Harmful</a> before embracing XHTML.</p>

<h3>5.6.3 LaTeX</h3>

<p>Three commands of special interest in the LaTeX bundle are:</p>

<ul>
<li><p><em>Typeset &amp; View (PDF)</em> (&#x2318;B) — this will run <code>pdflatex</code> on your current file, or <code>TM_LATEX_MASTER</code> (if that variable is set). If there were errors, these are shown as clickable links, otherwise the resulting PDF will be shown in the HTML output (requires Tiger or <a href="http://www.schubert-it.com/pluginpdf/">Schubert’s PDF Browser PlugIn</a>).</p></li>
<li><p><em>Insert Environment Based on Current Word</em> (&#x2318;{) — this mimics the HTML bundles &#x2303;&lt; in that it makes the current word into <code>\begin{word} … \end{word}</code> and places the caret in between. There are various configuration options for this command, for details see the Help command in the LaTeX bundle or the source for the command itself (via the Bundle Editor).</p></li>
<li><p><em>Insert Command Based on Current Word</em> (&#x2318;}) — like the previous command, but makes word into <code>\word{}</code> with the caret inside the braces.</p></li>
</ul>

<p>If you have not installed LaTeX you can use the <a href="http://ii2.sourceforge.net/">i-installer</a> (<a href="ftp://ftp.nluug.nl/pub/comp/macosx/volumes/ii2/">binaries</a>).</p>

<p>Alternatively, if you have <a href="http://macports.org/">MacPorts</a> then open your terminal and run:</p>

<pre><code>sudo port install teTeX
</code></pre>

<h3>5.6.4 Source</h3>

<p>The source bundle contains default actions and preferences for source code. Of interest is the <em>Comment Line / Selection</em> (&#x2318;/) which will toggle the comment characters for the current line or selection. This command is setup for different languages via three <a href="environment_variables#context_dependent_variables.html">context dependent variables</a>.</p>

<p>The various macros to go to end-of-line and insert the line terminator character (<code>;</code> by default) and/or a newline are also rather useful.</p>

<h3>5.6.5 SQL</h3>

<p>The SQL bundle has a command that can submit the current line or selection as a MySQL or Postgres query (&#x2303;&#x21E7;Q) and show the result using HTML output.</p>

<p>It uses a few <a href="environment_variables.html">environment variables</a> to store connection details. These are described in the bundle’s Help file.</p>

<h3>5.6.6 Subversion</h3>

<p>All actions in the subversion bundle are accessible through &#x2303;&#x21E7;A. These offer the commands which would be used in a common workflow.</p>

<p>None of the commands are made to prompt you for a password. For repositories offered through WebDav (i.e. <code>http</code> or <code>https</code>) <code>svn</code> should cache your authentication. <a href="http://macromates.com/blog/archives/2005/11/06/subversion-support-and-ssh-key-pairs/">This post describes how to generate an <code>ssh</code> key pair</a> for secure-shell tunneling (<code>ssh</code>).</p>

<p><img src='images/subversion_commit.png' width="203" height="181" alt="Subversion Commit" title=""></p>

<p>The commit action will commit the files selected in the project drawer or current file if there is no selection. The commit window also allows you to exclude files before doing the actual commit.</p>

<p>In the commit window you can use enter (&#x2305;) to trigger the “Commit” button shown in the bottom right corner.</p>

<h3>5.6.7 Text</h3>

<p>The text bundle is for actions and preferences related to basic text editing. From a users perspective some of this should probably have a more native placement than being in a bundle.</p>

<p>The four probably most useful actions are:</p>

<ul>
<li><p><em>Delete Line</em> (&#x2303;&#x21E7;K) — delete the current line.</p></li>
<li><p><em>Document Statistics</em> (&#x2303;&#x21E7;N) — this provides a tool tip which show how many lines, words and characters the current document contains.</p></li>
<li><p><em>Duplicate Line / Selection</em> (&#x2303;&#x21E7;D) — this will duplicate the current line, leaving the caret in the same column on the new line, or if there is a selection, duplicate that.</p></li>
<li><p><em>Sort Lines in Document / Selection</em> (F5) — this will sort the lines or selection alphabetically.</p></li>
</ul>

<h3>5.6.8 TextMate</h3>

<p>The TextMate bundle is kind of a meta bundle. That means none of the actions are for text editing but are instead intended for creating new bundle items, searching the mailing list archive, pasting the current selection to an IRC channel or similar.</p>

<p><img src='images/show_scope.png' width="296" height="110" alt="Show Scope" title=""></p>

<p>One command which is useful when working on <a href="themes.html">themes</a> or <a href="language_grammars.html">language grammars</a> is the <em>Show Scope</em> (&#x2303;&#x21E7;P) which shows the current scope of the caret (<a href="scope_selectors.html">more about scopes later</a>).</p>

<h3>5.6.9 Xcode</h3>

<p>The Xcode bundle has actions to build the Xcode project located in the folder that contains the current document or project and to run the resulting target.</p>

<p><img src='images/build_with_xcode.png' width="267" height="168" alt="Build With Xcode" title=""></p>

<p>It also has commands to import an Xcode project but generally it is better to drag the folder with your Xcode project to the TextMate application icon, since currently the <code>TM_PROJECT_DIRECTORY</code> variable is not correctly setup for imported projects and a lot of bundle actions rely on this (e.g. the Subversion stuff).</p>

<h2>5.7 Getting More Bundles</h2>

<p>Only the most popular bundles are included with TextMate. There is a subversion repository which has dozens of other bundles mostly adding support for various languages. You can <a href="http://svn.textmate.org/trunk/Bundles/">see the list of bundles here</a>.</p>

<h3>5.7.1 Installing Subversion</h3>

<p>If you are not using Leopard you will need to install the <a href="http://subversion.tigris.org/project_packages.html#binary-packages">subversion client</a>.</p>

<ul>
<li><p>If you have <a href="http://macports.org/">MacPorts</a> then open your terminal and run:</p>

<pre><code>sudo port install subversion
</code></pre></li>
<li><p>If you use <a href="http://fink.sourceforge.net/">Fink</a> then install the <a href="http://fink.sourceforge.net/pdb/package.php/svn-client">svn-client</a> package.</p></li>
<li><p>If you have neither Fink or MacPorts you can grab subversion from <a href="http://homepage.mac.com/martinott/">Martin Ott's homepage</a> or any of the pre-build binaries <a href="http://metissian.com/projects/macosx/subversion/">from here</a>.</p></li>
</ul>

<h3>5.7.2 Setting <code>LC_CTYPE</code></h3>

<p>You must set the <code>LC_CTYPE</code> variable to use UTF-8. If you do not, <code>svn</code> will give you an <code>svn: Can't recode string</code> error when it stumbles upon non-ASCII filenames (some of the bundle items use these).</p>

<p>If you are using bash you should put this in your <code>~/.bash_profile</code> (or a similar file which gets sourced when you open a terminal):</p>

<pre><code>export LC_CTYPE=en_US.UTF-8
</code></pre>

<p>Users of zsh should put it in <code>~/.zshrc</code> and tcsh users should instead put this line in their <code>~/.tcshrc</code>:</p>

<pre><code>setenv LC_CTYPE en_US.UTF-8
</code></pre>

<p>Remember that after adding this, you need to start a new shell for the updated profile to take effect.</p>

<p>Also be aware that the <code>LC_ALL</code> environment variable takes precedence over <code>LC_CTYPE</code>, so if you have set this elsewhere you should either unset it or change that to use UTF-8.</p>

<h3>5.7.3 Installing a Bundle</h3>

<p>When you have svn installed it is relatively easy to either checkout or export a bundle. TextMate searches for bundles in all the usual library locations, so if you have the rights to do so (on your machine) it is recommended that you perform all checkouts to <code>/Library</code> instead of <code>~/Library</code>, since this then keeps installed bundles separate from custom bundles (or bundles you have edited).</p>

<p>As an example, to install the Haskell bundle, first create the install directory, then change to it and ask <code>svn</code> to check it out:</p>

<pre><code>mkdir -p /Library/Application\ Support/TextMate/Bundles
cd /Library/Application\ Support/TextMate/Bundles
svn co http://svn.textmate.org/trunk/Bundles/Haskell.tmbundle
</code></pre>

<p>At a later time you can update the bundles which you have installed by executing these two lines:</p>

<pre><code>cd /Library/Application\ Support/TextMate/Bundles
svn up *.tmbundle
</code></pre>

<p>If TextMate is running while you perform the update, you may want to also execute the following line:</p>

<pre><code>osascript -e 'tell app "TextMate" to reload bundles'
</code></pre>

<p>This is equivalent to selecting Bundles &#x2192; Bundle Editor &#x2192; Reload Bundles from within TextMate.</p>

<h3>5.7.4 Support Folder</h3>

<p>Included with TextMate is a support folder which contains miscellaneous support items used by various bundle items. This folder is reachable via the <code>TM_SUPPORT_PATH</code> <a href="environment_variables.html">environment variable</a> and would normally point to <code>/Applications/TextMate.app/Contents/SharedSupport/Support</code>.</p>

<p>If you checkout a bundle from the subversion repository then this bundle may rely on a newer version of the support folder than the one included with TextMate. If this is the case, you will need to also checkout a local copy of the support folder.</p>

<p>The process is similar to checking out a bundle, first ensure you have <a href="bundles#setting_lc_ctype.html"><code>LC_CTYPE</code></a> setup properly and then execute the following in your shell:</p>

<pre><code>cd /Library/Application\ Support/TextMate
svn co http://svn.textmate.org/trunk/Support
</code></pre>

<p>After this you can test it by pasting the following line into TextMate and pressing &#x2303;R (to execute it):</p>

<pre><code>echo "$TM_SUPPORT_PATH"
</code></pre>

<p>It should result in the following output:</p>

<pre><code>/Library/Application Support/TextMate/Support
</code></pre>

<p>The support folder contains a version file (named <code>version</code>) so rather than pick the most local version of the support folder, TextMate will choose the one with the highest version. This means that if you do checkout a local copy of the support folder and later update TextMate, your local (potentially outdated) copy will not eclipse the default one.</p>

<h3>5.7.5 RSS Feed With Bundle Change Log</h3>

<p>Changes made to bundles are not part of the normal release notes. Instead these are <a href="feed://macromates.com/svnlog/bundles.rss">available through an RSS feed</a>.</p>

		</div>
		<div class="chapter">
			<h1>6 Macros</h1>

<p>TextMate supports recordable macros. A macro is recorded by selecting Macros &#x2192; Start Recording from the Bundles menu.</p>

<p>While recording, a red dot will pulsate in the right part of status bar and all text editing actions are recorded together with things like Find, running commands, inserting snippets etc. When done, you select Stop Recording and can either replay the recorded macro or save it for later use.</p>

<p>When saving a macro, it will appear in the bundle editor as (currently) a read-only macro which can get an <a href="bundles#activation_of_bundle_items.html">activation sequence</a> and <a href="scope_selectors.html">scope selector</a>, just like any other bundle item.</p>

<p>It is possible to set whether or not the macro should use a local clipboard while being executed. The local clipboard is generally advantageous (thus the default) but sometimes you may want the macro to effect the “real” clipboard and can disable this option.</p>

		</div>
		<div class="chapter">
			<h1>7 Snippets</h1>

<p>A snippet is a piece of text that you would like to insert in your document. It can include code to run at insertion time, variables (like selected text), tab stops/placeholders for missing information (which you can tab through after insertion) and perform transformations on the data which you enter in the placeholders.</p>

<p><img src='images/snippet_editor.png' width="305" height="208" alt="Snippet Editor" title=""></p>

<h2>7.1 Plain Text</h2>

<p>In the simplest case, you can use snippets to insert text that you do not want to type again and again, either because you type it a lot, or because the actual text to insert is hard to remember (like your bank account details or the HTML entities for the Apple modifier keys).</p>

<p>If you use snippets to insert plain text there is only one thing you should be aware of: <code>$</code> and <code>`</code> are reserved characters. So if you want to insert one of these, prefix it with an escape (i.e. <code>\$</code>). An escape not followed by one of these two characters (or followed by another escape) will be inserted as a literal character.</p>

<h2>7.2 Variables</h2>

<p>You can insert the value of a <a href="environment_variables.html">variable</a> by prefixing the name of the variable with <code>$</code>. All the normal dynamic variables are supported, the most useful probably being <code>TM_SELECTED_TEXT</code>. If for example we want to create a snippet which wraps the selection in a LaTeX <code>\textbf</code> command, we can make a snippet which is:</p>

<pre><code>\textbf{$TM_SELECTED_TEXT}
</code></pre>

<p>If no text is selected the variable will not be set, so nothing will be inserted in its place. We can provide a default value by using this syntax: <code>${«variable»:«default value»}</code>. For example:</p>

<pre><code>\textbf{${TM_SELECTED_TEXT:no text was selected}}
</code></pre>

<p>The default value can itself contain variables or shell code. If you want the default text to contain a <code>}</code>, you need to escape it. But all other characters are used verbatim.</p>

<p>Variables also support <a href="regular_expressions.html">regular expression</a> replacements using this syntax: <code>${«variable»/«regexp»/«format»/«options»}</code>. If the variable is not set the replacement will be performed on the empty string. For example, to prepend a bullet to each non-empty line in the selection (and insert that) we can do:</p>

<pre><code>${TM_SELECTED_TEXT/^.+$/• $0/g}
</code></pre>

<h2>7.3 Interpolated Shell Code</h2>

<p>You can use backticks to have shell code executed when the snippet is inserted. The result from running the code gets inserted into the snippet, though with the last newline in the result removed (if present). So for example to create a snippet that wraps the selection in an HTML link, where the URL of that link comes from the clipboard, we can do:</p>

<pre><code>&lt;a href="`pbpaste`.html"&gt;$TM_SELECTED_TEXT&lt;/a&gt;
</code></pre>

<p>Since this is normal bash code, we can write a small program. For example we can let it verify that the clipboard contains only a single line of text like this:</p>

<pre><code>&lt;a href="`
    if [[ $(pbpaste|wc -l) -eq 0 ]]
        then pbpaste
        else echo http://example.com/
    fi
`"&gt;$TM_SELECTED_TEXT&lt;/a&gt;
</code></pre>

<p>Inside shell code, the only character you need to escape is the backtick.</p>

<h2>7.4 Tab Stops</h2>

<p>After insertion, the caret will be placed after the last character of the snippet. This is not always desirable and we can change that by using <code>$0</code> to mark where we want the caret to be. So if for example we make an HTML div-snippet and want the caret to end between the opening and closing tags, we could make it like this:</p>

<pre><code>&lt;div&gt;
    $0
&lt;/div&gt;
</code></pre>

<p>Often though we want to fill in text in several places in the snippet. Multiple tab stops can be provided by inserting <code>$1</code>-<code>$n</code>. The caret will start at <code>$1</code>, then when pressing tab it will move to <code>$2</code> and <code>$3</code> on next tab etc. until there are no more tab stops. If you do not explicitly set <code>$0</code>, the caret will be at the end of the snippet.</p>

<p>So we could for example change the above to:</p>

<pre><code>&lt;div$1&gt;
    $0
&lt;/div&gt;
</code></pre>

<p>This allows us to fill in an argument and then tab on to <code>$0</code>.</p>

<h2>7.5 Placeholders</h2>

<p>Like variables, tab stops can also have default values (and are generally referred to as placeholders when they do). The syntax is the same: <code>${«tab stop»:«default value»}</code>. And the default value can contain both text, shell code and other placeholders. So we can refine the previous example further:</p>

<pre><code>&lt;div${1: id="${2:some_id}"}&gt;
    $0
&lt;/div&gt;
</code></pre>

<p>Inserting this snippet will insert a <code>div</code> tag with the <code>id</code> argument selected and we can then decide either to overtype the argument (i.e. delete it) and press tab again to reach <code>$0</code>, or we can press tab immediately to get to the second tab stop (the value part of the argument) and edit that.</p>

<p>When you edit the placeholder text, any embedded tab stops will be removed.</p>

<h2>7.6 Mirrors</h2>

<p>There are times when you need to provide the same value several places in the inserted text and in these situations you can re-use the tab stop to signal that you want it mirrored at that location. So for example to create a LaTeX environment with a snippet, we can use:</p>

<pre><code>\begin{${1:enumerate}}
    $0
\end{$1}
</code></pre>

<p>After inserting this snippet, <code>enumerate</code> will be selected and if we edit it, the changes will be reflected in the <code>\end</code> part as well.</p>

<h2>7.7 Transformations</h2>

<p>There are situations where we want our placeholder text mirrored but with slight changes or where we want some text to appear depending on the value/presence of a placeholder.</p>

<p>We can accomplish this by doing a regular expression substitution on the placeholder text (when mirroring it). The syntax for this is: <code>${«tab stop»/«regexp»/«format»/«options»}</code>.</p>

<p>As an example, the Objective-C getter/setter methods often look like this:</p>

<pre><code>- (id)foo
{
    return foo;
}

- (void)setFoo:(id)aValue
{
    [foo autorelease];
    foo = [aValue retain];
}
</code></pre>

<p>In the <a href="regular_expressions#replacement_string_syntax_format_strings.html">format string</a> we can use <code>\u</code> to uppercase the next character, so a snippet that only asks for the name of the instance variable once could look like this:</p>

<pre><code>- (${1:id})${2:foo}
{
    return $2;
}

- (void)set${2/./\u$0/}:($1)aValue
{
    [$2 autorelease];
    $2 = [aValue retain];
}
</code></pre>

<p>We can also use <a href="regular_expressions#conditional_insertions.html">conditional insertions</a> in the format string to make decisions. For example if we create a snippet for a method we can let the return type decide whether or not the method should include a <code>return</code> statement like this:</p>

<pre><code>- (${1:void})${2:methodName}
{${1/void$|(.+)/(?1:\n\treturn nil;)/}
}
</code></pre>

<p>Here we match placeholder 1 against <code>void</code> or anything (<code>.+</code>) and put the latter match in capture register 1. Then only if we did match something (other than <code>void</code>) will we insert a newline, tab and the <code>return nil;</code> text.</p>

		</div>
		<div class="chapter">
			<h1>8 Shell Commands</h1>

<p>The shell is a scripting language used to piece together various programs (shell commands), and often in an interactive way, e.g. as done when launching Terminal and entering commands to execute.</p>

<p>For a thorough introduction to the shell scripting language have a look at this <a href="http://developer.apple.com/documentation/OpenSource/Conceptual/ShellScripting/index.html">shell tutorial provided by Apple</a>.</p>

<h2>8.1 Executing Commands / Filtering Text</h2>

<p>TextMate allows shell commands to be executed in different contexts. Some of the more useful options are:</p>

<ol>
<li><p>In the current document, either press &#x2303;R with no selection to run the current line as a shell command, or select one or more lines and use &#x2303;R to run the selection as a shell script (it supports shebang as well).</p>

<p><img src='images/execute_line.png' width="264" height="54" alt="Execute Line" title=""></p></li>
<li><p>From the Text menu you can select Filter Through Command… (&#x2325;&#x2318;R) which opens a panel where you can enter a shell command to run and set what should be given as input (stdin) plus what to do with the output of the command (often you want to set input to the selected text and let the output replace the selection).</p>

<p><img src='images/filter_through_command.png' width="212" height="182" alt="Filter Through Command" title=""></p></li>
<li><p><a href="commands.html">Commands</a> via the Bundle Editor. The first two options are mostly for one-shot commands, whereas commands created in the Bundle Editor are for stuff you want to run again later. The options here are the same as those of option 2, i.e. you can set what to do with input/output, even have the output shown as a tool tip (e.g. for commands which lookup help for the current word) or HTML (e.g. for commands which build the project and show results, incrementally). You can also set that documents should be saved before executing the command and give the command a key equivalent or tab trigger.</p>

<p><img src='images/command_editor.png' width="416" height="269" alt="Command Editor" title=""></p></li>
</ol>

<h2>8.2 Search Path</h2>

<p>When running a command from Terminal, the shell will use the value of the <code>PATH</code> variable to locate it (when it is specified without an absolute location). For example <code>ruby</code> is located in <code>/usr/bin/ruby</code> and <code>svn</code> is (for me) located in <code>/opt/local/bin/svn</code>.</p>

<p>TextMate would normally <a href="http://developer.apple.com/qa/qa2001/qa1255.html">inherit the value of <code>PATH</code> from Finder</a>, which has only a few search locations specified, so this is not very useful.</p>

<p>Instead TextMate runs a custom script (named <code>bash_init.sh</code> located in <code>$TM_SUPPORT_PATH/lib</code>) before executing the actual shell command(s). This custom script contains the following code:</p>

<pre><code>if [ ! -f "$TM_BASH_INIT" ]; then

   # First read system-wide profile
   [ -f /etc/profile ] &amp;&amp; . /etc/profile

   # Then find the first local profile
   if   [ -f ~/.bash_profile ]; then . ~/.bash_profile
   elif [ -f ~/.bash_login   ]; then . ~/.bash_login
   elif [ -f ~/.profile      ]; then . ~/.profile
   fi

fi
</code></pre>

<p>What this means is that unless you create your own custom <code>bash_init.sh</code> script then TextMate will get the path which would occur by first sourcing (executing) <code>/etc/profile</code> and then the first bash initialization file found in your home folder.</p>

<p>If you do not normally use the bash shell, you may have to setup the path you normally have (in <code>tcsh</code>, <code>zsh</code>, or similar). For example create a <code>~/.bash_profile</code> file containing these lines:</p>

<pre><code>[ -f /etc/profile ] &amp;&amp; . /etc/profile
[ -f ~/.bashrc ]    &amp;&amp; . ~/.bashrc

export PATH="$HOME/bin:/opt/local/bin:$PATH"
</code></pre>

<p>This will add <code>~/bin</code> and <code>/opt/local/bin</code> to the path. Notice that <code>$HOME</code> is used instead of <code>~</code>, that is because inside double-quoted strings <code>~</code> is not expanded but <code>$HOME</code> is.</p>

<p><strong>Important:</strong> commands which use the shell shebang syntax to call a specific interpreter (e.g. <code>#!/usr/bin/ruby</code> or <code>#!/usr/bin/env ruby</code> on the first line of the command) do not go through this startup procedure, so these will not get the extended path. For these it is possible to augment the path by setting <code>PATH</code> in <a href="http://developer.apple.com/documentation/MacOSX/Conceptual/BPRuntimeConfig/Articles/EnvironmentVars.html#//apple_ref/doc/uid/20002093-113982"><code>~/.MacOSX/environment.plist</code></a> which is a property list that contains key/value pairs corresponding to <a href="http://developer.apple.com/qa/qa2001/qa1067.html">environment variables read by Finder when you login</a>.</p>

<p>So if you want to add <code>/opt/local/bin</code> to the path then create <code>~/.MacOSX/environment.plist</code> and add the following:</p>

<pre><code>{ PATH = "/opt/local/bin:/usr/bin:/bin:/usr/sbin:/sbin"; }
</code></pre>

<p>After having created (or edited) this file you will need to re-login to your user account for the change to take effect.</p>

<p>Note that in this file you are not able to refer to <code>$HOME</code> so you will instead have to use something like <code>/Users/allan/bin</code> for <code>$HOME/bin</code> (substituting <code>allan</code> with the name of your user).</p>

		</div>
		<div class="chapter">
			<h1>9 Environment Variables</h1>

<p>Environment variables are used extensively in TextMate to provide scripts and commands with information.</p>

<p>Here is how to read the value of a variable (named <code>VAR</code>) in different scripting languages:</p>

<ul>
<li>Bash — <code>"$VAR"</code></li>
<li>Perl — <code>$ENV{'VAR'}</code></li>
<li>PHP — <code>$_ENV['VAR']</code></li>
<li>Python — <code>os.environ['VAR']</code> (remember to <code>import os</code> first)</li>
<li>Ruby — <code>ENV['VAR']</code></li>
</ul>

<p>You can use them directly in Snippets, like in bash. Both bash and snippets support an extended form (<code>${VAR}</code>) where it is possible to do replacements in the variable, provide fallback values (if it is unset) etc.</p>

<p>Remember to double-quote variables used in shell scripts, otherwise bash will first expand the variable to its value and then split this according to the input-field-separator characters (read as the <code>IFS</code> variable, defaults to spaces, tabs and newlines). This means if <code>TM_FILENAME</code> is <code>My Document.txt</code> and we execute <code>rm $TM_FILENAME</code> then <code>rm</code> will actually get two arguments, first one being <code>My</code> and the second one being <code>Document.txt</code>.</p>

<p>For info about what can be done with environment variables in bash, see <a href="http://macromates.com/blog/archives/2005/09/26/shell-variables/">this blog post</a> about the issue or check out the bash man file.</p>

<h2>9.1 Dynamic Variables</h2>

<p>The following variables reflect the users current configuration, which file he has open, where the caret is located in that file, the selection in the project drawer and so on.</p>

<p>A script can read these variables and make decisions accordingly.</p>

<p>Some of the variables are not always present. For example if the current file is untitled, or there is no selection, the corresponding variable will be unset. This is useful for example to make a command work with the selection, but fall back on the current line or word.</p>

<p>Bash has shorthand notation for providing a default value when a variable is not set, for example to fallback on the current word when there is no selection, we would use: <code>"${TM_SELECTED_TEXT:-$TM_CURRENT_WORD}"</code>.</p>

<ul>
<li><p><code>TM_BUNDLE_SUPPORT</code> — shell commands which are (indirectly) triggered from a bundle item (which could be a <a href="commands.html">Command</a>, <a href="drag_commands.html">Drag Command</a>, <a href="macros.html">Macro</a>, or <a href="snippets.html">Snippet</a>) will have this variable pointing to the Support folder of the bundle that ran the item, if such a folder exists. In addition, <code>$TM_BUNDLE_SUPPORT/bin</code> will be added to the path.</p></li>
<li><p><code>TM_CURRENT_LINE</code> — textual content of the current line.</p></li>
<li><p><code>TM_CURRENT_WORD</code> — the word in which the caret is located.</p></li>
<li><p><code>TM_DIRECTORY</code> — the folder of the current document (may not be set).</p></li>
<li><p><code>TM_FILEPATH</code> — path (including file name) for the current document (may not be set).</p></li>
<li><p><code>TM_LINE_INDEX</code> — the index in the current line which marks the caret’s location. This index is zero-based and takes the utf-8 encoding of the line (e.g. read as <code>TM_CURRENT_LINE</code>) into account. So to split a line into what is to the left and right of the caret you could do:</p>

<pre><code>echo "Left:  »${TM_CURRENT_LINE:0:TM_LINE_INDEX}«"
echo "Right: »${TM_CURRENT_LINE:TM_LINE_INDEX}«"
</code></pre></li>
<li><p><code>TM_LINE_NUMBER</code> — the carets line position (counting from 1). For example if you need to work with the part of the document above the caret you can set the commands input to “Entire Document” and use the following to cut off the part below and including the current line:</p>

<pre><code>head -n$((TM_LINE_NUMBER-1))
</code></pre></li>
<li><p><code>TM_PROJECT_DIRECTORY</code> — the top-level folder in the project drawer (may not be set).</p></li>
<li><p><code>TM_SCOPE</code> — the scope that the caret is inside. See <a href="scope_selectors.html">scope selectors</a> for information about scopes.</p></li>
<li><p><code>TM_SELECTED_FILES</code> — space separated list of the files and folders selected in the project drawer (may not be set). The paths are shell-escaped, so to use these, you need to prefix the line with <code>eval</code> (to make the shell re-evaluate the line, after expanding the variable). For example to run the <code>file</code> command on all selected files in the project drawer, the shell command would be:</p>

<pre><code>eval file "$TM_SELECTED_FILES"
</code></pre>

<p>It is also possible to convert it to an (bash) array and iterate over this, for example:</p>

<pre><code>eval arr=("$TM_SELECTED_FILES")
for (( i = 0; i &lt; ${#arr[@]}; i++ )); do
    file "${arr[$i]}"
done
</code></pre></li>
<li><p><code>TM_SELECTED_FILE</code> — full path of the first selected file or folder in the project drawer (may not be set).</p></li>
<li><p><code>TM_SELECTED_TEXT</code> — full content of the selection (may not be set). Note that environment variables have a size limitation of roughly 64 KB, so if the user selects more than that, this variable will not reflect the actual selection (commands that need to work with the selection should generally set this to be the standard input).</p></li>
<li><p><code>TM_SOFT_TABS</code> — this will have the value <code>YES</code> if the user has enabled soft tabs, otherwise it has the value <code>NO</code>. This is useful when a shell command generates an indented result and wants to match the users preferences with respect to tabs versus spaces for the indent.</p></li>
<li><p><code>TM_SUPPORT_PATH</code> — the TextMate application bundle contains a <a href="bundles#support_folder.html">support folder</a> with several items which are used by some of the default commands (for example CocoaDialog, Markdown, the SCM commit window, Textile, tidy, etc.). This variable points to that support folder. Generally you would not need to use the variable directly since <code>$TM_SUPPORT_PATH/bin</code> is added to the path, so using some of the bundled commands can be done without having to specify their full path.</p></li>
<li><p><code>TM_TAB_SIZE</code> — the tab size as shown in the status bar. This is useful when creating commands which need to present the current document in another form (Tidy, convert to HTML or similar) or generate a result which needs to match the tab size of the document. See also <code>TM_SOFT_TABS</code>.</p></li>
</ul>

<h2>9.2 Static Variables</h2>

<p>In addition to the dynamic variables, which TextMate provides automatically, it is sometimes useful to provide a list of static variables.</p>

<p>For example you may have templates or snippets that should insert your company name and prefer not to put the value directly in these, or there could be shared commands which need localized settings, for example the SQL bundle has a query command which use variables for username, password and database.</p>

<p>For this reason it is possible to set a default list of environment variables in Preferences &#x2192; Advanced &#x2192; Shell Variables.</p>

<p><img src='images/shell_variables.png' width="239" height="213" alt="Shell Variables" title=""></p>

<p>These variables are given to all shell commands started from TextMate and can also be used in snippets (as can the dynamic variables for that matter).</p>

<h2>9.3 Context Dependent Variables</h2>

<p>Some variables are a cross between dynamic and static. For example the Source bundle contains a Toggle Comment command which will toggle the comment for the current line or selection. This command uses three variables to decide what type of comment style the user wants.</p>

<p>A user who works with multiple languages will however need to specify this per language. This can be done by setting the <code>shellVariables</code> array in the <a href="preferences_items.html">bundle preferences</a> and provide the proper <a href="scope_selectors.html">scope selector</a> to limit these variables.</p>

<p><img src='images/scoped_environment_variables.png' width="351" height="233" alt="Scoped Environment Variables" title=""></p>

<p>This has the advantage of actually being based on the carets location, which for the Toggle Comment command allows us to have it work differently for JavaScript, CSS, HTML and embedded PHP + Ruby, all in the same document.</p>

<p>An example of setting the 3 variables to comment the entire block (instead of line-by-line) with the HTML/SGML/XML comment markers is shown here:</p>

<pre><code>shellVariables = (
   {  name = 'TM_COMMENT_START';
      value = '&lt;!-- ';
   },
   {  name = 'TM_COMMENT_END';
      value = ' --&gt;';
   },
   {  name = 'TM_COMMENT_MODE';
      value = 'block';
   },
);
</code></pre>

<h2>9.4 Project Dependent Variables</h2>

<p>Sometimes it is useful to have a command customized differently depending on the project. For this reason, it is possible to set variables for individual projects.</p>

<p>The way to do this is currently a little secret but if you deselect everything in the project drawer, then click the info (circled I) button, a panel will appear where you can set variables.</p>

<p>These variables are saved in the project file (<code>*.tmproj</code>) and will exist only for snippets and (shell) commands executed in the context of that project.</p>

		</div>
		<div class="chapter">
			<h1>10 Commands</h1>

<p>Commands are scripts interpreted by bash or the interpreter specified at the top using shebang notation (e.g. <code>#!/usr/bin/ruby</code>).</p>

<p>Editing commands is done from the Bundle Editor which you can open by selecting Bundles &#x2192; Bundle Editor &#x2192; Edit Commands…</p>

<p><img src='images/command_editor.png' width="416" height="269" alt="Command Editor" title=""></p>

<p>TextMate can save either the current document or all modified documents in the project, before running the command. This is set using the top pop-up control. A document will only be saved when it has been modified.</p>

<h2>10.1 Command Input</h2>

<p>When running a command the various <a href="environment_variables.html">environment variables</a> will be available for the command to read and use. In addition, the command can read either the entire document or the selected text as input (stdin).</p>

<p>If the input is set to “Selected Text” and there is no selection, the command will instead get the fallback unit specified in the additional input pop-up control. If the fallback unit is used and the output is set to “Replace Selection” then the unit used as input will be replaced. So if we make a command like <code>tr '[a-z]' '[A-Z]'</code> (uppercase text) and set input to Selected Text but fallback to word and set output to replace selected text, then running the command with no selection, will uppercase the current word.</p>

<p><img src='images/input_fallback_options.png' width="351" height="169" alt="Input Fallback Options" title=""></p>

<p>One fallback unit which requires a little explanation is <em>Scope</em>. When the input is set to this, TextMate will search backwards and forwards for the first character which is not matched by the scope selector of the command and use those as boundaries for the input.</p>

<p>This means that if the language grammar marks up URLs and gives these a scope of <code>markup.underline.url</code> then a command with that as the scope selector can set its input to <em>Selection or Scope</em> and will thus get the URL as input, when this command is executed with the caret on an URL.</p>

<p>When a command name is shown outside the bundle editor (like in the menus) and a fallback unit is provided then TextMate will substitute “<em>Unit</em> / Selection” (in its name) with either “<em>Unit</em>” or “Selection” depending on whether or not text is selected. The text used for <em>Unit</em> should be a single word representing the fallback unit, i.e. Character, Word, Line, Scope (or what the scope represents, but as a single word), or Document. So if you make a command with the name “Encrypt Document / Selection” and specify its input as Selected Text, but with Document set as a fallback, this command will be presented as “Encrypt Document” when no text is selected, otherwise “Encrypt Selection.”</p>

<h2>10.2 Command Output</h2>

<p>TextMate can do miscellaneous things with the output (stdout) of a command, the options are:</p>

<ul>
<li><p><em>Replace Selected Text / Document</em> — this output option is mainly for commands which transform the selection/document, for example running the document through <code>tidy</code> or sort the lines read from stdin.</p></li>
<li><p><em>Insert as Text / Snippet</em> — commands which generate output to be inserted in the document, for example inserting missing close tag (by parsing the document read from stdin down to the caret position) or similar.</p></li>
<li><p><em>Show as Tool Tip</em> — commands which are mainly actions, like submit the selection to a pasting service or similar can discretely report the status of the action using just a tool tip.</p>

<p><img src='images/tool_tip_output.png' width="240" height="154" alt="Tool Tip Output" title=""></p></li>
<li><p><em>Show as HTML</em> — this output option simply shows the output as HTML, but has some additional advantages mentioned in next section. It is especially useful for commands which need to report incremental progress, as shown with the Xcode Build below.</p>

<p><img src='images/build_with_xcode.png' width="267" height="168" alt="Build With Xcode" title=""></p></li>
<li><p><em>Create New Document</em> — with some transformations (like converting a Markdown document to HTML) it may be preferable to open the result in a new document rather than overwrite the existing document and that is what this option is for. There are also commands for which the result is best shown as a document, for example the output from <code>diff</code> can be shown as a (new) document to get nice syntax coloring.</p>

<p><img src='images/diff_result.png' width="241" height="180" alt="Diff Result" title=""></p></li>
</ul>

<h2>10.3 HTML Output</h2>

<p>The HTML output option has a few advantages in addition to providing access to <a href="http://webkit.opendarwin.org/">WebKit’s</a> HTML and CSS engine.</p>

<ol>
<li><p>The HTML output does not stall TextMate while the command is running. A progress indicator is shown in the upper right hand corner while the command is running and it can be aborted by closing the output window (a confirmation requester is presented).</p>

<p><img src='images/html_output_progress_indicator.png' width="44" height="44" alt="Html Output Progress Indicator" title=""></p></li>
<li><p>JavaScript running as part of the output has access to a <code>TextMate</code> object with a <code>system</code> method that mimics the one <a href="http://developer.apple.com/documentation/AppleApplications/Conceptual/Dashboard_ProgTopics/Articles/CommandLine.html">provided to Dashboard widgets</a>. The <code>TextMate</code> object also has an <code>isBusy</code> property which can be set to <code>true</code> or <code>false</code> to control the windows progress indicator. So in the simplest case, to allow the user to start/stop the progress indicator one could make a command like this:</p>

<pre><code>cat &lt;&lt;'EOF'
   &lt;a href="javascript:TextMate.isBusy = true"&gt;Start&lt;/a&gt;
   &lt;a href="javascript:TextMate.isBusy = false"&gt;Stop&lt;/a&gt;
EOF
</code></pre>

<p>To create a link which opens the user’s browser, one could use the <code>system</code> method like this:</p>

<pre><code>cat &lt;&lt;'EOF'
   &lt;a href="javascript:TextMate.system(
      'open http://example.com/', null);"&gt;Open Link&lt;/a&gt;
EOF
</code></pre>

<p>The <code>system</code> method allows starting (and stopping) of commands asynchronously, reading standard out/error from the command and sending data to the commands standard input. For further information see <a href="http://developer.apple.com/documentation/AppleApplications/Conceptual/Dashboard_ProgTopics/Articles/CommandLine.html">the Dashboard documentation</a>.</p></li>
<li><p>The HTML output allows the use of the <a href="using_textmate_from_terminal#url_scheme_html.html">TextMate URL scheme</a> to link back to a given document. This is useful either when the command reports errors (or warnings) with the current document (e.g. a build command or a validator) or when the command refers to other files in the project, e.g. <code>svn status</code>.</p></li>
<li><p>Using either Tiger or Schuberts <a href="http://www.schubert-it.com/pluginpdf/">PDF Browser Plug-in</a> it is possible to have the HTML output show PDF files. Mainly this is useful for typesetting programs like LaTeX, where it is then possible to typeset and view the result without leaving TextMate.</p></li>
<li><p>It is possible to redirect to other pages and thereby treat the HTML output as a shortcut to your browser. For example in PHP the “Documentation for Word” command outputs a line like this:</p>

<pre><code>echo "&lt;meta http-equiv='Refresh'
        content='0;URL=http://php.net/$TM_CURRENT_WORD'&gt;"
</code></pre></li>
</ol>

<p>Due to a (presumed) security restriction with WebKit it is not possible to have the HTML output redirect, link or reference files on your disk via the <code>file:</code> URL scheme. Instead you can use the <code>tm-file:</code> URL scheme, which works exactly like <code>file:</code>, but does not have this cross-scheme restriction.</p>

<p>For a longer post about how the HTML output can be used visit <a href="http://macromates.com/blog/archives/2005/09/28/html-output-for-commands/">the TextMate blog</a>.</p>

<h2>10.4 Changing Output Type</h2>

<p>There are situations where it is useful to change the output option of a command from within the command. For example a command which looks up documentation for the current word may want to show a “no documentation found” tool tip for when there is no documentation, but otherwise use the HTML output option for the result.</p>

<p><img src='images/command_output_options.png' width="157" height="141" alt="Command Output Options" title=""></p>

<p>TextMate has a few predefined bash functions which can be used for this purpose. They optionally take a string as an argument which is first <code>echo</code>’ed to stdout.</p>

<p>These functions only work when the initial output option is <em>not</em> set as "Show as HTML". The list of functions is as follows:</p>

<ul>
<li><code>exit_discard</code></li>
<li><code>exit_replace_text</code></li>
<li><code>exit_replace_document</code></li>
<li><code>exit_insert_text</code></li>
<li><code>exit_insert_snippet</code></li>
<li><code>exit_show_html</code></li>
<li><code>exit_show_tool_tip</code></li>
<li><code>exit_create_new_document</code></li>
</ul>

<p>So for example the Diff bundle has a “[Diff] Document With Saved Copy” that compares the current document with the version saved on disk. The default output option for that is to create a new document (showing the diff output with syntax highlighting), but it will show an error (as a tool tip) if there is no file on disk. This can be done using the following command:</p>

<pre><code>if [[ -e "$TM_FILEPATH" ]] # does the file exist?
   then diff -u "$TM_FILEPATH" -
   else exit_show_tool_tip "No saved copy exists."
fi
</code></pre>

<h2>10.5 Useful bash Functions</h2>

<p>When running commands there are a few predefined bash functions which might be useful:</p>

<ul>
<li><p><code>require_cmd</code> — ensure that the command given as the first argument exists in the path and otherwise report an error to the user and abort the command. This is useful if you rely on commands not shipped with OS X and want to distribute your work, for example the Subversion commands start by doing:</p>

<pre><code>require_cmd svn
</code></pre></li>
<li><p><code>rescan_project</code> — currently TextMate will only update the project drawer (and reload the current file if it was  changed externally) when regaining focus. This bash function is shorthand for using AppleScript to deactivate and reactivate TextMate. It is useful if your command either modifies the current document (on disk) or changes files in folders which are part of the current project.</p></li>
<li><p><code>pre</code> — this command reads text from stdin and outputs an HTML-escaped version to stdout, putting the entire thing in <code>&lt;pre&gt;…&lt;/pre&gt;</code> (though with word wrap enabled) and converting <code>&lt;</code>, <code>&gt;</code> and <code>&amp;</code> to the corresponding HTML entities. This is useful when you want to show raw output but use the HTML output option. In the simplest case you can just specify <code>pre</code> as the command and set input to “Entire Document” and output to “Show as HTML”, but generally you would probably want the result from some command to be piped through <code>pre</code>, for example:</p>

<pre><code>make clean|pre
</code></pre></li>
</ul>

<p>The functions mentioned above are all defined in <code>$TM_SUPPORT_PATH/lib/bash_init.sh</code>. There are also functions to aid in HTML construction (from bash) in <code>$TM_SUPPORT_PATH/lib/html.sh</code>, but this file is not sourced by default. So to use the functions defined in that file you would start by sourcing it e.g.:</p>

<pre><code>. "$TM_SUPPORT_PATH/lib/html.sh"
redirect "http://example.com/"
</code></pre>

<h2>10.6 Dialogs (Requesting Input &amp; Showing Progress)</h2>

<p>TextMate ships with CocoaDialog so this can be used out-of-the-box. You call <a href="http://cocoadialog.sourceforge.net/documentation.html">CocoaDialog</a> (follow the link for full documentation) with the type of dialog you want and it will return two lines of text, the first is the button pressed (as a number) and the second is the actual result. While a little cumbersome, here is an example of how to request a line of text and only proceed if the user did not cancel:</p>

<pre><code>res=$(CocoaDialog inputbox --title "I Need Input" \
    --informative-text "Please give me a string:" \
    --button1 "Okay" --button2 "Cancel")

[[ $(head -n1 &lt;&lt;&lt;"$res") == "2" ]] &amp;&amp; exit_discard

res=$(tail -n1 &lt;&lt;&lt;"$res")
echo "You entered: $res"
</code></pre>

<p>We first call CocoaDialog to get a string of text. Then we test if the first line returned (using <code>head</code>) is equal to 2, which corresponds to the Cancel button and if so, we exit (using the discard output option). We then go on to extract the last line of the result and <code>echo</code> that.</p>

<p><img src='images/cocoadialog_inputbox.png' width="319" height="122" alt="Cocoadialog Inputbox" title=""></p>

<p>Another common dialog type is the progress indicator. The determinate version reads from stdin the value and text to use for each step. This means we can simply pipe that info to CocoaDialog in each step of our command, a simple example could be:</p>

<pre><code>for (( i = 1; i &lt;= 100; i++ )); do
    echo "$i We're now at $i%"; sleep .05
done|CocoaDialog progressbar --title "My Program"
</code></pre>

<p><img src='images/cocoadialog_determinate_progress.png' width="287" height="83" alt="Cocoadialog Determinate Progress" title=""></p>

<p>Often though we want to show the indeterminate version. This dialog stays onscreen for as long as its stdin is open. This means we can use a pipe like above but if we want a result back from the command that we are executing, we can instead redirect the commands stderr to an instance of CocoaDialog (using process substitution), this is shown in the following example:</p>

<pre><code>revs=$(svn log -q "$TM_FILEPATH"|grep -v '^-*$' \
    2&gt; &gt;(CocoaDialog progressbar --indeterminate \
        --title "View Revision…" \
        --text "Retrieving List of Revisions…" \
    ))
echo "$revs"
</code></pre>

<p><img src='images/cocoadialog_indeterminate_progress.png' width="287" height="83" alt="Cocoadialog Indeterminate Progress" title=""></p>

<p>CocoaDialog also has other dialog types, like a pop-up list, file panel, text box and so on, but as an alternative there is also AppleScript.</p>

<p>If you open Script Editor and then open the Standard Additions dictionary (via Open Dictionary…) there are commands under User Interaction which allow various dialogs. One caveat though, in current version (1.5) TextMate will not listen to AppleScript commands while executing shell commands with an output option other than Show as HTML. This means that instead of targeting TextMate, you should use <code>SystemUIServer</code> or similar and in addition to that, since <code>SystemUIServer</code> needs to be activated to show the dialog (with focus) you need to reactivate TextMate. Here is an example of a command that allows selecting an item from a list:</p>

<pre><code>res=$(osascript &lt;&lt;'AS'
    tell app "TextMate"
        activate
        choose from list { "red", "green", "blue" } \
            with title "Pick a Color" \
            with prompt "What color do you like?"
    end tell
AS)

echo "You selected: $res"

osascript -e 'tell app "TextMate" to activate' &amp;&gt;/dev/null &amp;
</code></pre>

<p>The first part is just a small AppleScript which is executed from shell via <code>osascript</code> (reading the script from stdin using a here-doc). The last part is the line that gives focus back to TextMate but because TextMate will not respond to this event before the shell command has completed its execution, we need to run it asynchronously, which is done by adding <code>&amp;</code> to the end of the command. The <code>&amp;&gt;/dev/null</code> part is to detach stdout/error from the shell command so that this does not cause a stall.</p>

<p><img src='images/as_choose_from_list.png' width="159" height="140" alt="AppleScript Choose From List" title=""></p>

		</div>
		<div class="chapter">
			<h1>11 Drag Commands</h1>

<p>Drag commands are like normal commands but they are activated by dropping a particular file type (specified as a list of file type extensions) into the editing window.</p>

<p><img src='images/drag_command_file_types.png' width="173" height="33" alt="Drag Command File Types" title=""></p>

<p>The output from executing a drag command is always inserted as a snippet and the drag command has three (additional) <a href="environment_variables.html">environment variables</a> available:</p>

<ul>
<li><p><code>TM_DROPPED_FILE</code> — relative path of the file dropped (relative to the document directory, which is also set as the current directory).</p></li>
<li><p><code>TM_DROPPED_FILEPATH</code> — the absolute path of the file dropped.</p></li>
<li><p><code>TM_MODIFIER_FLAGS</code> — the modifier keys which were held down when the file got dropped. This is a bitwise OR in the form: <code>SHIFT|CONTROL|OPTION|COMMAND</code> (in case all modifiers were down).</p></li>
</ul>

<p>So here is a slightly complex drag command:</p>

<pre><code>img="$TM_DROPPED_FILE"
echo -n "&lt;img src=\"$img\" "

sips -g pixelWidth -g pixelHeight "$img" \
|awk '/pixelWidth/  { printf("width=\"%d\" ",  $2) }
      /pixelHeight/ { printf("height=\"%d\" ", $2) }'

base=${img##*/}
alt=$(tr &lt;&lt;&lt;${base%.*} '[_-]' ' '|perl -pe 's/(\w+)/\u$1/g')
echo -n "alt=\"\${1:$alt}\"&gt;"
</code></pre>

<p>First we output the <code>&lt;img src="…"</code> part. Then we use <code>sips</code> to query the image and <code>awk</code> to parse the output from <code>sips</code> and output the proper <code>width="…"</code> and <code>height="…"</code> arguments. Last we convert <code>-</code> and <code>_</code> in the path to spaces and capitalize each word and output this as the final <code>alt="…"</code> argument, where we make this text a placeholder (since the entire thing is inserted as a snippet).</p>

<p><img src='images/drag_command_result.png' width="294" height="34" alt="Drag Command Result" title=""></p>

		</div>
		<div class="chapter">
			<h1>12 Language Grammars</h1>

<p>Language grammars are used to assign names to document elements such as keywords, comments, strings or similar. The purpose of this is to allow styling (syntax highlighting) and to make the text editor “smart” about which context the caret is in. For example you may want a key stroke or tab trigger to act differently depending on the context, or you may want to disable spell check as you type those portions of your text document which are not prose (e.g. HTML tags).</p>

<p>The language grammar is used only to parse the document and assign names to subsets of this document. Then <a href="scope_selectors.html">scope selectors</a> can be used for styling, preferences and deciding how keys and tab triggers should expand.</p>

<p>For a more thorough introduction to this concept see the <a href="http://macromates.com/blog/archives/2005/07/06/introduction-to-scopes/">introduction to scopes</a> blog post.</p>

<h2>12.1 Example Grammar</h2>

<p>You can create a new language grammar by opening the bundle editor (Window &#x2192; Show Bundle Editor) and select “New Language” from the add button in the lower left corner.</p>

<p>This will give you a starting grammar which will look like the one below, so let us start by explaining that.</p>

<pre><code> 1  {  scopeName = 'source.untitled';
 2     fileTypes = ( );
 3     foldingStartMarker = '\{\s*$';
 4     foldingStopMarker = '^\s*\}';
 5     patterns = (
 6        {  name = 'keyword.control.untitled';
 7           match = '\b(if|while|for|return)\b';
 8        },
 9        {  name = 'string.quoted.double.untitled';
10           begin = '"';
11           end = '"';
12           patterns = ( 
13              {  name = 'constant.character.escape.untitled';
14                 match = '\\.';
15              }
16           );
17        },
18     );
19  }
</code></pre>

<p>The format is the <a href="appendix#property_list_format.html">property list format</a> and at the root level there are five key/value pairs:</p>

<ul>
<li><p><code>scopeName</code> (line 1) — this should be a unique name for the grammar, following the convention of being a dot-separated name where each new (left-most) part specializes the name. Normally it would be a two-part name where the first is either <code>text</code> or <code>source</code> and the second is the name of the language or document type. But if you are specializing an existing type, you probably want to derive the name from the type you are specializing. For example Markdown is <code>text.html.markdown</code> and Ruby on Rails (<code>rhtml</code> files) is <code>text.html.rails</code>. The advantage of deriving it from (in this case) <code>text.html</code> is that everything which works in the <code>text.html</code> scope will also work in the <code>text.html.«something»</code> scope (but with a lower precedence than something specifically targeting <code>text.html.«something»</code>).</p></li>
<li><p><code>fileTypes</code> (line 2) — this is an array of file type extensions that the grammar should (by default) be used with. This is referenced when TextMate does not know what grammar to use for a file the user opens. If however the user selects a grammar from the language pop-up in the status bar, TextMate will remember that choice.</p></li>
<li><p><code>foldingStartMarker</code> / <code>foldingStopMarker</code> (line 3-4) — these are regular expressions that lines (in the document) are matched against. If a line matches one of the patterns (but not both), it becomes a folding marker (see the <a href="navigation_overview#customizing_foldings.html">foldings</a> section for more info).</p></li>
<li><p><code>patterns</code> (line 5-18) — this is an array with the actual rules used to parse the document. In this example there are two rules (line 6-8 and 9-17). Rules will be explained in the next section.</p></li>
</ul>

<p>There are two additional (root level) keys which are not used in the example:</p>

<ul>
<li><p><code>firstLineMatch</code> — a regular expression which is matched against the first line of the document (when it is first loaded). If it matches, the grammar is used for the document (unless there is a user override). Example: <code>^#!/.*\bruby\b</code>.</p></li>
<li><p><code>repository</code> — a dictionary (i.e. key/value pairs) of rules which can be included from other places in the grammar. The key is the name of the rule and the value is the actual rule. Further explanation (and example) follow with the description of the <code>include</code> rule key.</p></li>
</ul>

<h2>12.2 Language Rules</h2>

<p>A language rule is responsible for matching a portion of the document. Generally a rule will specify a name which gets assigned to the part of the document which is matched by that rule.</p>

<p>There are two ways a rule can match the document. It can either provide a single regular expression, or two. As with the <code>match</code> key in the first rule above (lines 6-8), everything which matches that regular expression will then get the name specified by that rule. For example the first rule above assigns the name <code>keyword.control.untitled</code> to the following keywords: <code>if</code>, <code>while</code>, <code>for</code> and <code>return</code>. We can then use a <a href="scope_selectors.html">scope selector</a> of <code>keyword.control</code> to have our <a href="themes.html">theme</a> style these keywords.</p>

<p>The other type of match is the one used by the second rule (lines 9-17). Here two regular expressions are given using the <code>begin</code> and <code>end</code> keys. The name of the rule will be assigned from where the begin pattern matches to where the end pattern matches (including both matches). If there is no match for the end pattern, the end of the document is used.</p>

<p>In this latter form, the rule can have sub-rules which are matched against the part between the begin and end matches. In our example here we match strings that start and end with a quote character and escape characters are marked up as <code>constant.character.escape.untitled</code> inside the matched strings (line 13-15).</p>

<p><em>Note that the regular expressions are matched against only a <strong>single line of the document</strong> at a time. That means it is <strong>not possible to use a pattern that matches multiple lines</strong>.</em> The reason for this is technical: being able to restart the parser at an arbitrary line and having to re-parse only the minimal number of lines affected by an edit. In most situations it is possible to use the begin/end model to overcome this limitation.</p>

<h2>12.3 Rule Keys</h2>

<p>What follows is a list of all keys which can be used in a rule.</p>

<ul>
<li><p><code>name</code> — the name which gets assigned to the portion matched. This is used for styling and scope-specific settings and actions, which means it should generally be derived from one of the standard names (see <a href="language_grammars#naming_conventions.html">naming conventions</a> later).</p></li>
<li><p><code>match</code> — a regular expression which is used to identify the portion of text to which the name should be assigned. Example: <code>'\b(true|false)\b'</code>.</p></li>
<li><p><code>begin</code>, <code>end</code> — these keys allow matches which span several lines and must both be mutually exclusive with the <code>match</code> key. Each is a regular expression pattern. <code>begin</code> is the pattern that starts the block and <code>end</code> is the pattern which ends the block. Captures from the <code>begin</code> pattern can be referenced in the <code>end</code> pattern by using normal regular expression back-references. This is often used with here-docs, for example:</p>

<pre><code>{   name = 'string.unquoted.here-doc';
    begin = '&lt;&lt;(\w+)';  // match here-doc token
    end = '^\1$';       // match end of here-doc
}
</code></pre>

<p>A <code>begin</code>/<code>end</code> rule can have nested patterns using the <code>patterns</code> key. For example we can do:</p>

<pre><code>{  begin = '&lt;%'; end = '%&gt;'; patterns = (
      { match = '\b(def|end)\b'; … },
      …
   );
};
</code></pre>

<p>The above will match <code>def</code> and <code>end</code> keywords inside a <code>&lt;% … %&gt;</code> block (though for embedded languages see info about the <code>include</code> key later).</p></li>
<li><p><code>contentName</code> — this key is similar to the <code>name</code> key but only assigns the name to the text <strong>between</strong> what is matched by the <code>begin</code>/<code>end</code> patterns. For example to get the text between <code>#if 0</code> and <code>#endif</code> marked up as a comment, we would do:</p>

<pre><code>{  begin = '#if 0(\s.*)?$'; end = '#endif';
   contentName = 'comment.block.preprocessor';
};
</code></pre></li>
<li><p><code>captures</code>, <code>beginCaptures</code>, <code>endCaptures</code> — these keys allow you to assign attributes to the captures of the <code>match</code>, <code>begin</code>, or <code>end</code> patterns. Using the <code>captures</code> key for a <code>begin</code>/<code>end</code> rule is short-hand for giving both <code>beginCaptures</code> and <code>endCaptures</code> with same values.</p>

<p>The value of these keys is a dictionary with the key being the capture number and the value being a dictionary of attributes to assign to the captured text. Currently <code>name</code> is the only attribute supported. Here is an example:</p>

<pre><code>{  match = '(@selector\()(.*?)(\))';
   captures = {
      1 = { name = 'storage.type.objc'; };
      3 = { name = 'storage.type.objc'; };
   };
};
</code></pre>

<p>In that example we match text like <code>@selector(windowWillClose:)</code> but the <code>storage.type.objc</code> name will only be assigned to <code>@selector(</code> and <code>)</code>.</p></li>
<li><p><code>include</code> — this allows you to reference a different language, recursively reference the grammar itself or a rule declared in this file’s repository.</p>

<ol>
<li><p>To reference another language, use the scope name of that language:</p>

<pre><code>{  begin = '&lt;\?(php|=)?'; end = '\?&gt;'; patterns = (
      { include = "source.php"; }
   );
}
</code></pre></li>
<li><p>To reference the grammar itself, use <code>$self</code>:</p>

<pre><code>{  begin = '\('; end = '\)'; patterns = (
      { include = "$self"; }
   );
}
</code></pre></li>
<li><p>To reference a rule from the current grammars repository, prefix the name with a pound sign (<code>#</code>):</p>

<pre><code>patterns = (
   {  begin = '"'; end = '"'; patterns = (
         { include = "#escaped-char"; },
         { include = "#variable"; }
      );
   },
   …
); // end of patterns
repository = {
   escaped-char = { match = '\\.'; };
   variable =     { match = '\$[a-zA-Z0-9_]+'; };
};
</code></pre>

<p>This can also be used to match recursive constructs like balanced characters:</p>

<pre><code>patterns = (
   {  name = 'string.unquoted.qq.perl';
      begin = 'qq\('; end = '\)'; patterns = (
         { include = '#qq_string_content'; },
      );
   },
   …
); // end of patterns
repository = {
   qq_string_content = {
      begin = '\('; end = '\)'; patterns = (
         { include = '#qq_string_content'; },
      );
   };
};
</code></pre>

<p>This will correctly match a string like: <code>qq( this (is (the) entire) string)</code>.</p></li>
</ol></li>
</ul>

<h2>12.4 Naming Conventions</h2>

<!-- punctuation scope: http://pastie.textmate.org/15698 -->

<p>TextMate is free-form in the sense that you can assign basically any name you wish to any part of the document that you can markup with the grammar system and then use that name in <a href="scope_selectors.html">scope selectors</a>.</p>

<p>There are however conventions so that one <a href="themes.html">theme</a> can target as many languages as possible, without having dozens of rules specific to each language and also so that functionality (mainly <a href="preferences_items.html">preferences</a>) can be re-used across languages, e.g. you probably do not want an apostrophe to be auto-paired when inserted in strings and comments, regardless of the language you are in, so it makes sense to only set this up once.</p>

<p>Before going through the conventions, here are a few things to keep in mind:</p>

<ol>
<li><p>A minimal theme will only assign styles to 10 of the 11 root groups below (<code>meta</code> does not get a visual style), so you should “spread out” your naming i.e. instead of putting everything below <code>keyword</code> (as your formal language definition may insist) you should think “would I want these two elements styled differently?” and if so, they should probably be put into different root groups.</p></li>
<li><p>Even though you should “spread out” your names, when you have found the group in which you want to place your element (e.g. <code>storage</code>) you should re-use the existing names used below that group (for <code>storage</code> that is <code>modifier</code> or <code>type</code>) rather than make up a new sub-type. You should however append as much information to the sub-type you choose. For example if you are matching the <code>static</code> storage modifier, then instead of just naming it <code>storage.modifier</code> use <code>storage.modifier.static.«language»</code>. A scope selector of just <code>storage.modifier</code> will match both, but having the extra information in the name means it is possible to specifically target it disregarding the other storage modifiers.</p></li>
<li><p>Put the language name last in the name. This may seem redundant, since you can generally use a scope selector of: <code>source.«language» storage.modifier</code>, but when embedding languages, this is not always possible.</p></li>
</ol>

<p>And now the 11 root groups which are currently in use with some explanation about their intended purpose. This is presented as a hierarchical list but the actual scope name is obtained by joining the name from each level with a dot. For example <code>double-slash</code> is <code>comment.line.double-slash</code>.</p>

<ul>
<li><p><code>comment</code> — for comments.</p>

<ul>
<li><code>line</code> — line comments, we specialize further so that the type of comment start character(s) can be extracted from the scope.
<ul>
<li><code>double-slash</code> — <code>// comment</code></li>
<li><code>double-dash</code> — <code>-- comment</code></li>
<li><code>number-sign</code> — <code># comment</code></li>
<li><code>percentage</code> — <code>% comment</code></li>
<li><em>character</em> — other types of line comments.</li>
</ul></li>
<li><code>block</code> — multi-line comments like <code>/* … */</code> and <code>&lt;!-- … --&gt;</code>.
<ul>
<li><code>documentation</code> — embedded documentation.</li>
</ul></li>
</ul></li>
<li><p><code>constant</code> — various forms of constants.</p>

<ul>
<li><code>numeric</code> — those which represent numbers, e.g. <code>42</code>, <code>1.3f</code>, <code>0x4AB1U</code>.</li>
<li><code>character</code> — those which represent characters, e.g. <code>&amp;lt;</code>, <code>\e</code>, <code>\031</code>.
<ul>
<li><code>escape</code> — escape sequences like <code>\e</code> would be <code>constant.character.escape</code>.</li>
</ul></li>
<li><code>language</code> — constants (generally) provided by the language which are “special” like <code>true</code>, <code>false</code>, <code>nil</code>, <code>YES</code>, <code>NO</code>, etc.</li>
<li><code>other</code> — other constants, e.g. colors in CSS.</li>
</ul></li>
<li><p><code>entity</code> — an entity refers to a larger part of the document, for example a chapter, class, function, or tag. We do not scope the entire entity as <code>entity.*</code> (we use <code>meta.*</code> for that). But we do use <code>entity.*</code> for the “placeholders” in the larger entity, e.g. if the entity is a chapter, we would use <code>entity.name.section</code> for the chapter title.</p>

<ul>
<li><code>name</code> — we are naming the larger entity.
<ul>
<li><code>function</code> — the name of a function.</li>
<li><code>type</code> — the name of a type declaration or class.</li>
<li><code>tag</code> — a tag name.</li>
<li><code>section</code> — the name is the name of a section/heading.</li>
</ul></li>
<li><code>other</code> — other entities.
<ul>
<li><code>inherited-class</code> — the superclass/baseclass name.</li>
<li><code>attribute-name</code> — the name of an attribute (mainly in tags).</li>
</ul></li>
</ul></li>
<li><p><code>invalid</code> — stuff which is “invalid”.</p>

<ul>
<li><code>illegal</code> — illegal, e.g. an ampersand or lower-than character in HTML (which is not part of an entity/tag).</li>
<li><code>deprecated</code> — for deprecated stuff e.g. using an API function which is deprecated or using styling with strict HTML.</li>
</ul></li>
<li><p><code>keyword</code> — keywords (when these do not fall into the other groups).</p>

<ul>
<li><code>control</code> — mainly related to flow control like <code>continue</code>, <code>while</code>, <code>return</code>, etc.</li>
<li><code>operator</code> — operators can either be textual (e.g. <code>or</code>) or be characters.</li>
<li><code>other</code> — other keywords.</li>
</ul></li>
<li><p><code>markup</code> — this is for markup languages and generally applies to larger subsets of the text.</p>

<ul>
<li><code>underline</code> — underlined text.
<ul>
<li><code>link</code> — this is for links, as a convenience this is derived from <code>markup.underline</code> so that if there is no theme rule which specifically targets <code>markup.underline.link</code> then it will inherit the underline style.</li>
</ul></li>
<li><code>bold</code> — bold text (text which is strong and similar should preferably be derived from this name).</li>
<li><code>heading</code> — a section header. Optionally provide the heading level as the next element, for example <code>markup.heading.2.html</code> for <code>&lt;h2&gt;…&lt;/h2&gt;</code> in HTML.</li>
<li><code>italic</code> — italic text (text which is emphasized and similar should preferably be derived from this name).</li>
<li><code>list</code> — list items.
<ul>
<li><code>numbered</code> — numbered list items.</li>
<li><code>unnumbered</code> — unnumbered list items.</li>
</ul></li>
<li><code>quote</code> — quoted (sometimes block quoted) text.</li>
<li><code>raw</code> — text which is verbatim, e.g. code listings. Normally spell checking is disabled for <code>markup.raw</code>.</li>
<li><code>other</code> — other markup constructs.</li>
</ul></li>
<li><p><code>meta</code> — the meta scope is generally used to markup larger parts of the document. For example the entire line which declares a function would be <code>meta.function</code> and the subsets would be <code>storage.type</code>, <code>entity.name.function</code>, <code>variable.parameter</code> etc. and only the latter would be styled. Sometimes the meta part of the scope will be used only to limit the more general element that is styled, most of the time meta scopes are however used in scope selectors for activation of bundle items. For example in Objective-C there is a meta scope for the interface declaration of a class and the implementation, allowing the same tab-triggers to expand differently, depending on context.</p></li>
<li><p><code>storage</code> — things relating to “storage”.</p>

<ul>
<li><code>type</code> — the type of something, <code>class</code>, <code>function</code>, <code>int</code>, <code>var</code>, etc.</li>
<li><code>modifier</code> — a storage modifier like <code>static</code>, <code>final</code>, <code>abstract</code>, etc.</li>
</ul></li>
<li><p><code>string</code> — strings.</p>

<ul>
<li><code>quoted</code> — quoted strings.
<ul>
<li><code>single</code> — single quoted strings: <code>'foo'</code>.</li>
<li><code>double</code> — double quoted strings: <code>"foo"</code>.</li>
<li><code>triple</code> — triple quoted strings: <code>"""Python"""</code>.</li>
<li><code>other</code> — other types of quoting: <code>$'shell'</code>, <code>%s{...}</code>.</li>
</ul></li>
<li><code>unquoted</code> — for things like here-docs and here-strings.</li>
<li><code>interpolated</code> — strings which are “evaluated”: <code>`date`</code>, <code>$(pwd)</code>.</li>
<li><code>regexp</code> — regular expressions: <code>/(\w+)/</code>.</li>
<li><code>other</code> — other types of strings (should rarely be used).</li>
</ul></li>
<li><p><code>support</code> — things provided by a framework or library should be below <code>support</code>.</p>

<ul>
<li><code>function</code> — functions provided by the framework/library. For example <code>NSLog</code> in Objective-C is <code>support.function</code>.</li>
<li><code>class</code> — when the framework/library provides classes.</li>
<li><code>type</code> — types provided by the framework/library, this is probably only used for languages derived from C, which has <code>typedef</code> (and <code>struct</code>). Most other languages would introduce new types as classes.</li>
<li><code>constant</code> — constants (magic values) provided by the framework/library.</li>
<li><code>variable</code> — variables provided by the framework/library. For example <code>NSApp</code> in AppKit.</li>
<li><code>other</code> — the above should be exhaustive, but for everything else use <code>support.other</code>.</li>
</ul></li>
<li><p><code>variable</code> — variables. Not all languages allow easy identification (and thus markup) of these.</p>

<ul>
<li><code>parameter</code> — when the variable is declared as the parameter.</li>
<li><code>language</code> — reserved language variables like <code>this</code>, <code>super</code>, <code>self</code>, etc.</li>
<li><code>other</code> — other variables, like <code>$some_variables</code>.</li>
</ul></li>
</ul>

		</div>
		<div class="chapter">
			<h1>13 Scope Selectors</h1>

<p>A <em>scope selector</em> is a pattern much like a CSS selector which is matched against the scope of the caret (i.e. current context) and the outcome is either a match or a non-match (see also: ranking matches further down).</p>

<p><img src='images/scope_selector.png' width="307" height="56" alt="Scope Selector" title=""></p>

<p>This allows the <a href="bundles#activation_of_bundle_items.html">activation method</a> of a bundle item to be limited to contexts like “inside a comment” or “in an HTML document”. The advantage of this is that it allows a tab trigger like <code>for</code> to be re-used in different languages and works smoothly for mixed documents like HTML which can have embedded CSS, PHP, Ruby and JavaScript.</p>

<p>Scope selectors are also used with <a href="preferences_items.html">preference items</a> and <a href="themes.html">themes</a>. In the latter case they are used to style elements of a document and in the former case to adjust various aspects of editing etc. on a granular basis.</p>

<h2>13.1 Element Names</h2>

<p>Generally a document consists of many different elements. A prose document may contain headings, paragraphs, bullet lists, emphasized text where source code will often contain strings, comments, keywords, storage types etc.</p>

<p>In TextMate the <a href="language_grammars.html">language grammars</a> will match these elements and assign a name to each. This name should be dot separated with each additional part specializing the kind of element matched. For example a double-quoted string in C will get <code>string.quoted.double.c</code> assigned as its scope name (see <a href="language_grammars#naming_conventions.html">naming conventions</a> for more info).</p>

<p>A scope selector in its simplest form is an element name to match, but it only needs to specify a prefix of the actual element name. So if we specify <code>string</code> as our scope selector it will also match all quoted strings. Likewise if we specify <code>string.quoted</code> it will match single, double and triple quoted strings.</p>

<p>An empty scope selector will match all scopes but with the lowest possible rank (see <a href="scope_selectors#ranking_matches.html">ranking matches</a> later).</p>

<h2>13.2 Descendant Selectors</h2>

<p>As with CSS, it is possible to use the context of an element in the scope selector. The picture below shows the scope for the string as a tool tip (via &#x2303;&#x21E7;P). The direct parent of the string is <code>source.php.embedded.html</code> and  <code>text.html.basic</code> is an ancestor.</p>

<p><img src='images/show_scope.png' width="296" height="110" alt="Show Scope" title=""></p>

<p>In the scope selector we specify element names as a space separated list to indicate that each element should be present in the scope (and in the same order). So if we want to target all strings in PHP, we can use <code>source.php string</code>, or we can use <code>text.html source.php</code> to target PHP embedded in HTML.</p>

<h2>13.3 Excluding Elements</h2>

<p>There are situations where we want to match a subset of a document but exclude particular subsets of this subset.</p>

<p>For example in Ruby it is possible to embed code in strings using <code>#{…}</code>, so a nice snippet would be to insert that when pressing <code>#</code> inside of a string. The scope selector for that would be: <code>source.ruby string</code>.</p>

<p>This unfortunately means that even inside code (embedded in strings) <code>#</code> will insert <code>#{…}</code>. To avoid this, we can subtract scope selectors to get the (asymmetric) difference using the minus operator. So a better scope selector for our snippet would be <code>source.ruby string - string source</code>.</p>

<p>Below is an illustration of what that scope selector would target.</p>

<pre><code>puts "Today is #{Date.today}."
     ^^^^^^^^^^             ^^
</code></pre>

<h2>13.4 Grouping</h2>

<p>When we want something to match several distinct scopes, we can group scope selectors with the comma operator. For example to match both strings and comments the scope selector would be: <code>string, comment</code>.</p>

<h2>13.5 Ranking Matches</h2>

<p>If more than one scope selector matches the current scope then they are ranked according to how “good” a match they each are.</p>

<p>The winner is the scope selector which (in order of precedence):</p>

<ol>
<li><p>Match the element deepest down in the scope e.g. <code>string</code> wins over <code>source.php</code> when the scope is <code>source.php string.quoted</code>.</p></li>
<li><p>Match most of the deepest element e.g. <code>string.quoted</code> wins over <code>string</code>.</p></li>
<li><p>Rules 1 and 2 applied again to the scope selector when removing the deepest element (in the case of a tie), e.g. <code>text source string</code> wins over <code>source string</code>.</p></li>
</ol>

<p>In the case of tab triggers, key equivalents and dropped files (<a href="drag_commands.html">drag commands</a>), a menu is presented for the best matches when these are identical in rank (which would mean the scope selector in that case was identical).</p>

<p>For themes and preference items, the winner is undefined when multiple items use the same scope selector, though this is on a per-property basis. So for example if one theme item sets the background to blue for <code>string.quoted</code> and another theme item sets the foreground to white, again for <code>string.quoted</code>, the result would be that the foreground was taken from the latter item and background from the former.</p>

		</div>
		<div class="chapter">
			<h1>14 Themes</h1>

<p>TextMate uses <a href="language_grammars.html">language grammars</a> to assign names to document elements such as strings, comments, keywords and similar. It is possible to specify particular elements using <a href="scope_selectors.html">scope selectors</a> in the same way that you can use CSS selectors to select HTML elements.</p>

<p>Styling a document in TextMate is similar to creating a style sheet for an HTML document. The process happens in Preferences &#x2192; Fonts &amp; Colors where one can select a theme (analogous to a style sheet), edit one of the themes or create new themes.</p>

<p><img src='images/fonts_and_colors.png' width="191" height="229" alt="Fonts And Colors" title=""></p>

<p>Changing theme is global i.e. it is currently not possible to select a specific theme per file or file type.</p>

<p>A theme has six standard properties, these are the background, foreground, caret, selection, invisibles and line highlight color. In addition to that the theme consists of a list of “theme items”. Each of these items has a scope selector to select what element(s) the item should apply to and then optionally a foreground and background color and a font style (bold, italic and underline).</p>

<p><img src='images/remove_color.png' width="48" height="60" alt="Remove Color" title=""></p>

<p>If a theme item currently has no foreground or background color, you can click the FG or BG column to add one. If instead you want to remove it, drag away the color well shown in the FG or BG column until the disappearing mouse pointer shows and then release the mouse to have the color removed.</p>

<p>Remember that <a href="scope_selectors.html">scope selectors</a> can be complex, so it is possible to set the background for <code>text.html source.ruby</code> so that Ruby blocks in HTML gets a particular color for example or use <code>string - string source</code> to style only the part of a string which is not embedded code.</p>

<p><img src='images/composite_theme_colors.png' width="173" height="59" alt="Composite Theme Colors" title=""></p>

<h2>14.1 Sharing</h2>

<p>The TextMate wiki has a page for <a href="http://macromates.com/wiki/Themes/UserSubmittedThemes">custom themes</a> where users are encouraged to share their themes.</p>

		</div>
		<div class="chapter">
			<h1>15 Preferences Items</h1>

<p>For settings where differing values are useful to have based on a file type or the context of the caret position in a document, the bundle editor allows you to set and specify a scope selector which selects which scope the particular settings should apply.</p>

<p>Currently the preferences are specified in the <a href="appendix#property_list_format.html">old-style property list</a> format.</p>

<p><img src='images/preferences_editor.png' width="294" height="240" alt="Preferences Editor" title=""></p>

<h2>15.1 Completions</h2>

<ul>
<li><code>completions</code> — an array of additional candidates when cycling through completion candidates from the current document.</li>
<li><code>completionCommand</code> — a shell command (string) which should return a list of candidates to complete the current word (obtained via the <code>TM_CURRENT_WORD</code> variable).</li>
<li><code>disableDefaultCompletion</code> — set to <code>1</code> if you want to exclude matches from the current document when asking for completion candidates (useful when you provide your own completion command).</li>
</ul>

<p>For more info see section on <a href="working_with_text#completion.html">completions</a>.</p>

<h2>15.2 Indentation</h2>

<ul>
<li><code>decreaseIndentPattern</code> — regular expression.</li>
<li><code>increaseIndentPattern</code> — regular expression.</li>
<li><code>indentNextLinePattern</code> — regular expression.</li>
<li><code>unIndentedLinePattern</code> — regular expression.</li>
</ul>

<p>For more information see <a href="appendix#indentation_rules.html">indentation rules</a>.</p>

<h2>15.3 Symbol List</h2>

<ul>
<li><code>showInSymbolList</code> — set to <code>1</code> to include in the symbol list.</li>
<li><code>symbolTransformation</code> — a “program” consisting of one or more <code>s/«regexp»/«format»/«options»;</code> transformations which will be applied to the extracted “symbol”.</li>
</ul>

<p>For more information see <a href="navigation_overview#customizing_the_list.html">customizing the symbol list</a>.</p>

<h2>15.4 Paired Characters</h2>

<ul>
<li><code>highlightPairs</code> — an array of arrays, each containing a pair of characters where, when the caret moves over the second, the first one will be highlighted for a short moment, if found.</li>
<li><p><code>smartTypingPairs</code> — an array of arrays, each containing a pair of characters where when the first is typed, the second will be inserted. An example is shown below. For more information see <a href="working_with_text#auto-paired_characters_quotes_etc.html">auto-paired characters</a>.</p>

<pre><code>smartTypingPairs = (
    ( '"', '"' ),
    ( '(', ')' ),
    ( '{', '}' ),
    ( '[', ']' ),
    ( '“', '”' ),
    ( "'", "'" ),
    ( '`', '`' ),
);
</code></pre></li>
</ul>

<h2>15.5 Other</h2>

<ul>
<li><code>shellVariables</code> — an array of key/value pairs. See <a href="environment_variables#context_dependent_variables.html">context dependent variables</a>.</li>
<li><code>spellChecking</code> — set to <code>0</code>/<code>1</code> to disable/enable spell checking.</li>
</ul>

		</div>
		<div class="chapter">
			<h1>16 Key Bindings</h1>

<p>There are basically three types of actions in TextMate and each has its own system when it comes to key bindings (yes, this is not ideal).</p>

<h2>16.1 Bundle Items</h2>

<p>Bundle items are commands, snippets, macros, language grammars, templates etc. and can all be found in the bundle editor (Window &#x2192; Show Bundle Editor). Each of these actions has a <a href="bundles#key_equivalents.html">key equivalent</a> and an associated <a href="scope_selectors.html">scope selector</a> which can be edited from the bundle editor.</p>

<h2>16.2 Menu Items</h2>

<p>Menu items can be edited via System Preferences &#x2192; Keyboard &amp; Mouse. From here it is possible to change key bindings for either all applications or particular applications based on the menu items title.</p>

<p>This is done by pressing the plus button on the left side below the list on the Keyboard Shortcuts page, which displays the sheet shown below.</p>

<p><img src='images/change_menu_key_binding.png' width="261" height="139" alt="Change Menu Key Binding" title=""></p>

<p>Some caveats:</p>

<ol>
<li><p>Only key bindings which include the command modifier (&#x2318;) will work.</p></li>
<li><p>Dynamic menu items i.e. those which change title depending on the programs state (like Fold Current Block / Selection) should be specified with their initial title. The initial title can be found by opening the MainMenu.nib file in Interface Builder (use Show Package Contents on TextMate and navigate to Contents &#x2192; Resources &#x2192; English.lproj).</p></li>
<li><p>You need to restart an application before key binding changes take effect.</p></li>
</ol>

<p>An alternative to the system preferences is <a href="http://www.unsanity.com/haxies/menumaster">Menu Master</a> from <a href="http://www.unsanity.com/">Unsanity</a>. This allows you to change the key binding inside the application simply by hovering your mouse on the item and pressing the new key (and does not require a restart).</p>

<h2>16.3 Text Move / Edit Actions</h2>

<p>The last is probably the most essential, it is the keys which “just work” in the actual text editing area.</p>

<p>Here TextMate uses the Cocoa key bindings system where the master set of keys are defined in <code>/System/‍Library/‍Frameworks/‍AppKit.framework/‍Resources/‍StandardKeyBinding.dict</code> and used by all Cocoa text fields and to some degree other controls also.</p>

<p>The master set of keys can be augmented by <code>~/Library/‍KeyBindings/‍DefaultKeyBinding.dict</code>. The most common request with respect to key bindings is to have page up/down move the caret and have home/end go to the beginning and end of the line. <a href="http://macromates.com/blog/archives/2005/07/05/key-bindings-for-switchers/">This article</a> shows how this can be done.</p>

<p>In addition TextMate has a <code>/path/‍to/‍TextMate.app/‍Contents/‍Resources/‍KeyBindings.dict</code> file with some extra key bindings which are specific to TextMate (and thus not appropriate to put in the per user global key bindings file). You can copy this file to <code>~/Library/‍Application Support/‍TextMate</code> and edit it, this will then take precedence over the bundled file.</p>

<p>The format is explained in the blog post linked to above.</p>

<h3>16.3.1 List of Standard Key Bindings</h3>

<p>For a list of which keys are available by default (in OS X) please see <a href="http://hcs.harvard.edu/~jrus/Site/System Bindings.html">this list of key bindings</a> created by Jacob Rus.</p>

<p>Apple also has a page about <a href="http://developer.apple.com/documentation/UserExperience/Conceptual/OSXHIGuidelines/XHIGKeyboardShortcuts/chapter_20_section_1.html">standard key bindings</a> as part of their human Interface Guidelines. TextMate conforms to these and implement majority of the keys shown on that page.</p>

<p>In addition TextMate has the following key bindings, which are not visible in the menus and cannot be found in the standard key binding files:</p>

<table class="graybox" border="0" cellspacing="0" cellpadding="5">
    <tr>
        <th>Key</th>
        <th>Action</th>
    </tr>
    <tr>
        <td align="center"><p>&#x2325;F2</p></td>
        <td><p>Show context menu — This is equivalent to clicking the mouse at the current caret location while holding down control (&#x2303;). If the current word is misspelled the context menu will contain spelling suggestions.</p></td>
    </tr>
    <tr>
        <td align="center"><p>&#x2303;&#x238B;</p></td>
        <td><p>Show bundle items menu — this opens the gear menu which is located in the status bar.</p></td>
    </tr>
    <tr>
        <td align="center"><p>&#x2303;S</p></td>
        <td><p>Forward incremental search.</p></td>
    </tr>
    <tr>
        <td align="center"><p>&#x2303;&#x21E7;S</p></td>
        <td><p>Backward incremental search.</p></td>
    </tr>
    <tr>
        <td align="center"><p>&#x2318;`<br>&#x2318;~</p></td>
        <td><p>Switch to the next/previous window. This keyboard shortcut is based on the physical location of the key so on many European keymaps it is instead &#x2318;&lt; and &#x2318;&gt; (it is the key to the left of the Z).</p></td>
    </tr>
    <tr>
        <td align="center"><p>&#x2325;&#x2318;`<br>&#x2325;&#x2318;~</p></td>
        <td><p>Switch between main window and drawer. Like the previous key this one is also based on physical location. The function is not available on Panther.</p></td>
    </tr>
    <tr>
        <td align="center"><p>&#x2303;&#x21E5;</p></td>
        <td><p>Go backwards through the chain of keyboard accessible controls. Normally this would be the same as &#x21E4; (&#x21E7;&#x21E5;) but that one doesn’t work when the text editing control has focus. The previous keyboard accessible control in that situation is the project outline in the drawer, so this key could be considered a “bring focus to the project drawer” key.</p></td>
    </tr>
</table>

<h2>16.4 Conventions</h2>

<table class="graybox" border="0" cellspacing="0" cellpadding="5">
    <tr>
        <th>Modifiers</th>
        <th>Purpose</th>
    </tr>
    <tr>
        <td align="center">&#x2318;</td> <!-- command -->
        <td>This is for primary actions mostly defined by Apple or already a de-facto standard e.g. New, Open, Save, Print, Hide, Quit, Cut, Copy, Paste, etc.</td>
    </tr>
    <tr>
        <td align="center">&#x21E7;&#x2318;</td> <!-- shift command -->
        <td>Adding the shift modifier often indicates a twist on the plain key equivalent. For example<ul>
            <li>&#x2318;W is Close Tab — &#x21E7;&#x2318;W is Close Project (in a project)</li>
            <li>&#x2318;T is Go to File… — &#x21E7;&#x2318;T is Go to Symbol…</li>
            <li>&#x2318;V is Paste — &#x21E7;&#x2318;V is Paste Previous</li>
            <li>&#x2318;Z is Undo — &#x21E7;&#x2318;Z is Redo</li>
        </ul>etc.</td>
    </tr>
    <tr>
        <td align="center">&#x2325;&#x2318;</td> <!-- option command -->
        <td>Often (but definitely not always) this modifier sequence is used to toggle an option, e.g. Soft Wrap (&#x2325;&#x2318;W), Show Invisibles (&#x2325;&#x2318;I), Bookmarks (&#x2325;&#x2318;B), Line Numbers (&#x2325;&#x2318;L), Foldings at a given level (&#x2325;&#x2318;0-9) etc.</td>
    </tr>
    <tr>
        <td align="center">&#x2303;&#x2325;&#x2318;</td> <!-- control option command -->
        <td>This modifier sequence is generally used for actions which open a window. For example Show Bundle Editor (&#x2303;&#x2325;&#x2318;B), Show Clipboard History (&#x2303;&#x2325;&#x2318;V), Show/Hide Project Drawer (&#x2303;&#x2325;&#x2318;D), Show Web Preview (&#x2303;&#x2325;&#x2318;P) etc.</td>
    </tr>
    <tr>
        <td align="center">&#x2303;&#x21E7;</td> <!-- control shift -->
        <td>Less important bundle actions (commands and sometimes snippets) should generally use this modifier sequence.</td>
    </tr>
    <tr>
        <td align="center">&#x2303;&#x21E7;&#x2318;</td> <!-- control shift command -->
        <td>This is the secondary modifier sequence for use with less important bundle actions (i.e. when the primary one is taken).</td>
    </tr>
    <tr>
        <td align="center">&#x2303;&#x2325;&#x21E7;</td> <!-- control option shift -->
        <td>This is used to switch language grammar, the key is (generally) the first letter of the language grammar name.</td>
    </tr>
    <tr>
        <td align="center">&#x2303;&#x2318;</td> <!-- control command -->
        <td>Actions related to projects are in this space, e.g. New Project, Save Project, Reveal in Project, etc.</td>
    </tr>
</table>

		</div>
		<div class="chapter">
			<h1>17 Templates</h1>

<p>A template consists of a (shell) command which generates a new file based on the template's contents. Below is shown how an <code>index.html</code> file is part of the XHTML 1.1 template.</p>

<p><img src='images/xhtml_templates.png' width="135" height="67" alt="Xhtml Templates" title=""></p>

<p>When executing the template shell command, the working directory is set to the directory containing the template files so that these can be referenced by name only (i.e. without path) and the shell command has access to the following three environment variables (in addition to the <a href="environment_variables.html">normal variables</a>):</p>

<ul>
<li><p><code>TM_NEW_FILE</code> — the full path, including the name of the file to be generated (i.e. the one the user entered in the GUI).</p></li>
<li><p><code>TM_NEW_FILE_BASENAME</code> — the base name of the file to be generated. If <code>TM_NEW_FILE</code> is <code>/tmp/foo.txt</code> then this variable would be <code>foo</code> without the folder name and the file extension.</p></li>
<li><p><code>TM_NEW_FILE_DIRECTORY</code> — the folder name of the file to be generated.</p></li>
</ul>

<p>A template can then be instantiated either by using the menus (File &#x2192; New From Template) or for projects by using the New File button in the project drawer (&#x21E7;&#x2318;N).</p>

<p><img src='images/new_file_from_template.png' width="239" height="106" alt="New File From Template" title=""></p>

		</div>
		<div class="chapter">
			<h1>18 Printing</h1>

<p>To the amusement of some and the frustration of others, TextMate currently features only limited printing capabilities.</p>

<p>That means you can only use the document font with no syntax highlighting and no options except the standard printing options plus header and footer fields as shown below.</p>

<p><img src='images/printing_options.png' width="305" height="156" alt="Printing Options" title=""></p>

<p>The header and footer fields support the <a href="environment_variables.html">normal variables</a>, interpolated code using backticks and in addition has access to these two variables:</p>

<ul>
<li><p><code>TM_PAGE</code> — the current page being printed (this is the actual page number as if all pages in the document are printed, so even if you only print page 3, this variable will be 3 and not 1).</p></li>
<li><p><code>TM_PAGES</code> — total number of pages in the document.</p></li>
</ul>

<p>There are plans to improve the printing capabilities, but until then, there is also a command in the Source bundle (View Source as PDF) which produces a PDF from the current source using <a href="http://www.codento.com/people/mtr/genscript/"><code>enscript</code></a> and has syntax highlighting enabled for supported languages.</p>

		</div>
		<div class="chapter">
			<h1>19 Saving Files</h1>

<p>TextMate has a few options in the advanced preferences which affect how to save files.</p>

<p><img src='images/prefs_saving.png' width="239" height="213" alt="Prefs Saving" title=""></p>

<h2>19.1 Atomic Saves</h2>

<p>Atomic saves mean that instead of overwriting the file, TextMate saves to a new file and once this succeeds, overwrites the old file. This has the advantage that if your machine should crash while saving a file, you do not run the risk of losing the contents of both the old (last-saved) and new files.</p>

<p>The downside is that since a new file is actually written to disk (with a new inode), you may break an alias to the file, although this happens only if you also moved the file, or will move it, since path has precedence over inodes when resolving aliases. Also, the Finder will reposition the icon of the file each time you save it (which is only a problem if the file is in a folder you keep in sight).</p>

<h2>19.2 Creator Code</h2>

<p>The creator code is how Classic Macs associated a file with its application. On OS X the association is mainly through the file extension, which has the advantage that if you one day get a better program (!) to handle a given file type, you only need to update the association in one place, instead of changing the creator code of all your saved files. For this reason the recommendation is to not set this or set it to <em>Blank</em>.</p>

<h2>19.3 Encoding</h2>

<p>TextMate is heavily biased toward UTF-8. UTF-8 is an ASCII compatible encoding, so using it should give no problems with existing tools such as <code>grep</code>, <code>diff</code>, <code>ruby</code> (the interpreter), <code>gcc</code> (the compiler) etc.</p>

<p>Since the file system uses UTF-8 for filenames, Terminal is set to UTF-8 by default (to have the result from e.g. <code>ls</code> show correctly). This means that if you <code>cat</code> a non-ASCII file in Terminal or run a script which outputs more than ASCII (e.g. uses ellipsis or curly quotes), it will only show correctly if the output is UTF-8 (unless you change Terminal's encoding).</p>

<p>In addition, UTF-8 is the only encoding that can represent all the characters you can type on your Mac. Even things like the euro symbol (€) will give a problem with the older (legacy) encodings.</p>

<p>And as an extra bonus, UTF-8 is the only 8 bit encoding which is recognizable with a near 100% certainty, which means that as long as you use UTF-8, you should no longer experience opening a file and the text editor making a wrong guess about the encoding used (which can mess up the file if you then save it without noticing it).</p>

<p>A final argument for UTF-8 is that TextMate is only providing the infrastructure for a lot of functionality. All this functionality is written as scripts and these work with the current document, files in your project, the selection etc. An action might be to transform text, show a result as HTML in a new document etc. In almost all these situations, having to deal with encoding is impractical and sometimes not even possible (like if the result can not be represented using the encoding of the source), so for all this stuff, UTF-8 is assumed.</p>

<p>There is a post on the TextMate blog about <a href="http://macromates.com/blog/archives/2005/09/18/handling-encodings-utf-8/">how to handle UTF-8</a> in miscellaneous situations (POST'ing data to a web-server, setting the encoding for LaTeX documents, etc.).</p>

<p>Having said all that, it is possible to change the default encoding and if you only need to save out a single file with another encoding you can adjust that in the Save As… dialog. The list of encodings is short and it is intentionally that way. If you need to use other encodings, the current advice is to use <code>iconv</code>.</p>

<p>You can run <code>iconv -l</code> for a list of the hundreds of encodings it supports.</p>

<p>To convert a set of files to UTF-8 in the terminal, you can run something like this:</p>

<pre><code>for f in *.txt; do iconv -f mac -t utf-8 "$f" &gt;"$f.utf8"; done
</code></pre>

<h2>19.4 Extended Attributes (Metadata)</h2>

<p>Starting with Tiger, OS X supports <a href="http://developer.apple.com/documentation/Darwin/Reference/ManPages/man2/setxattr.2.html"><code>setxattr</code></a> and friends.</p>

<p>TextMate makes use of extended attributes to store the carets position, bookmarks, what text is folded and is likely to make further use of extended attributes in the future.</p>

<p>For filesystems which do not natively support extended attributes (like network mounted disks), OS X instead stores the extra information in a file named <code>._«filename»</code>, where <code>«filename»</code> is the name of the original file.</p>

<p>Since not all users think that this extra (hidden) file is worth having in order for TextMate to remember state, it is possible to disable the use of extended attributes by quitting TextMate and running the following from the shell:</p>

<pre><code>defaults write com.macromates.textmate OakDocumentDisableFSMetaData 1
</code></pre>

<h2>19.5 Save Automatically when Focus Is Lost</h2>

<p>If you are working with a project where you test your work by switching to another application (e.g. Terminal or a browser) you can set TextMate to save all modified files, when the focus is lost. That way, when you switch to the other application, TextMate will automatically save all your changes.</p>

		</div>
		<div class="chapter">
			<h1>20 Regular Expressions</h1>

<h2>20.1 Introduction</h2>

<p>A regular expression is a domain specific language for matching text. Naively we could write a small program to match text, but this is error-prone, tedious and not very portable or flexible.</p>

<p>Instead we use regular expressions which describe the match as a string which (in a simple case) consists of the character types to match and quantifiers for how many times we want to have the character type matched.</p>

<p>For example normal letters and digits match literally. Something like <code>\w</code> will match word characters, where <code>\s</code> will match whitespace characters (space, tab, newline, etc.). The period (<code>.</code>) will match any character (except newline).</p>

<p>The basic quantifiers are the asterisk (<code>*</code>) to specify that the match should happen zero or more times, plus (<code>+</code>) for one or more times, or a range can be given as <code>{min,max}</code>.</p>

<p>This alone gives us capabilities like finding words (<code>\w+</code>) or finding an image tag with an <code>alt</code> argument (<code>&lt;img.*alt=".*"&gt;</code>).</p>

<p>Matching longer text sequences is one thing, but often we are interested in the subset of the match. For example, in the above example we may want to replace the <code>alt</code> argument text. If we enclose part of the regular expression with parentheses, we <em>capture</em> that part in a variable that can be used in the replacement string. The format of the replacement string is described at the end of this section, but to refer to the first capture, we use <code>$1</code>, <code>$2</code> for the second etc.</p>

<p>So to change the <code>alt</code> argument text we could search for <code>(&lt;img.*alt=").*("&gt;)</code> and replace that with <code>$1Text Intentionally Removed$2</code>.</p>

<p><em>Note that in the examples above <code>.*</code> is used. The asterisk operator is however greedy, meaning that it will match as many characters as possible (which still allow a match to occur), so often we want to change it to non-greedy by adding <code>?</code>, making it <code>.*?</code>.</em></p>

<h3>20.1.1 External Resources</h3>

<ul>
<li><a href="http://www.regular-expressions.info/">Regular-Expressions.info</a></li>
<li>A.M. Kuchling’s <a href="http://www.amk.ca/python/howto/regex/">Regular Expression HOWTO</a></li>
<li>Steve Mansour’s <a href="http://linuxreviews.org/beginner/tao_of_regular_expressions/">A Tao of Regular Expressions</a></li>
<li>Jeffrey Friedl’s <a href="http://www.oreilly.com/catalog/regex2/">Mastering Regular Expressions</a> (book)</li>
</ul>

<h2>20.2 Regular Expressions in TextMate</h2>

<p>Here is a list of places where TextMate makes use of regular expressions:</p>

<ul>
<li>Filtering which files should be shown in folder references (added to projects) is done by providing regular expressions.</li>
<li>Find and Find in Project both allow regular expression replacements.</li>
<li>Folding markers are found via regular expressions.</li>
<li>Indentation calculations are based on regular expression matches.</li>
<li>Language grammars are basically a tree (with cycles) that have regular expressions in each node.</li>
<li>Snippets allow regular expression replacements to be applied to variables and (in realtime) mirrored placeholders.</li>
</ul>

<p>So needless to say, these play a big role in TextMate. While you can live a happy life without knowing about them, it is strongly recommended that you do pick up a book, tutorial or similar to get better acquainted with these (if you are not already).</p>

<p>In addition to TextMate, many common shell commands support regular expressions (<code>sed</code>, <code>grep</code>, <code>awk</code>, <code>find</code>) and popular scripting languages like Perl and Ruby have regular expressions ingrained deep into the language.</p>

<h2>20.3 Syntax (Oniguruma)</h2>

<p>TextMate uses the Oniguruma regular expression library by K. Kosako.</p>

<p>The following is taken from <a href="http://www.geocities.jp/kosako3/oniguruma/doc/RE.txt">http://www.geocities.jp/kosako3/oniguruma/doc/RE.txt</a>.</p>

<pre><code>Oniguruma Regular Expressions Version 5.6.0    2007/04/03

syntax: ONIG_SYNTAX_RUBY (default)


1. Syntax elements

  \       escape (enable or disable meta character meaning)
  |       alternation
  (...)   group
  [...]   character class  


2. Characters

  \t           horizontal tab (0x09)
  \v           vertical tab   (0x0B)
  \n           newline        (0x0A)
  \r           return         (0x0D)
  \b           back space     (0x08)
  \f           form feed      (0x0C)
  \a           bell           (0x07)
  \e           escape         (0x1B)
  \nnn         octal char            (encoded byte value)
  \xHH         hexadecimal char      (encoded byte value)
  \x{7HHHHHHH} wide hexadecimal char (character code point value)
  \cx          control char          (character code point value)
  \C-x         control char          (character code point value)
  \M-x         meta  (x|0x80)        (character code point value)
  \M-\C-x      meta control char     (character code point value)

 (* \b is effective in character class [...] only)


3. Character types

  .        any character (except newline)

  \w       word character

           Not Unicode:
             alphanumeric, "_" and multibyte char. 

           Unicode:
             General_Category -- (Letter|Mark|Number|Connector_Punctuation)

  \W       non word char

  \s       whitespace char

           Not Unicode:
             \t, \n, \v, \f, \r, \x20

           Unicode:
             0009, 000A, 000B, 000C, 000D, 0085(NEL), 
             General_Category -- Line_Separator
                              -- Paragraph_Separator
                              -- Space_Separator

  \S       non whitespace char

  \d       decimal digit char

           Unicode: General_Category -- Decimal_Number

  \D       non decimal digit char

  \h       hexadecimal digit char   [0-9a-fA-F]

  \H       non hexadecimal digit char


  Character Property

    * \p{property-name}
    * \p{^property-name}    (negative)
    * \P{property-name}     (negative)

    property-name:

     + works on all encodings
       Alnum, Alpha, Blank, Cntrl, Digit, Graph, Lower,
       Print, Punct, Space, Upper, XDigit, Word, ASCII,

     + works on EUC_JP, Shift_JIS
       Hiragana, Katakana

     + works on UTF8, UTF16, UTF32
       Any, Assigned, C, Cc, Cf, Cn, Co, Cs, L, Ll, Lm, Lo, Lt, Lu,
       M, Mc, Me, Mn, N, Nd, Nl, No, P, Pc, Pd, Pe, Pf, Pi, Po, Ps,
       S, Sc, Sk, Sm, So, Z, Zl, Zp, Zs, 
       Arabic, Armenian, Bengali, Bopomofo, Braille, Buginese,
       Buhid, Canadian_Aboriginal, Cherokee, Common, Coptic,
       Cypriot, Cyrillic, Deseret, Devanagari, Ethiopic, Georgian,
       Glagolitic, Gothic, Greek, Gujarati, Gurmukhi, Han, Hangul,
       Hanunoo, Hebrew, Hiragana, Inherited, Kannada, Katakana,
       Kharoshthi, Khmer, Lao, Latin, Limbu, Linear_B, Malayalam,
       Mongolian, Myanmar, New_Tai_Lue, Ogham, Old_Italic, Old_Persian,
       Oriya, Osmanya, Runic, Shavian, Sinhala, Syloti_Nagri, Syriac,
       Tagalog, Tagbanwa, Tai_Le, Tamil, Telugu, Thaana, Thai, Tibetan,
       Tifinagh, Ugaritic, Yi



4. Quantifier

  greedy

    ?       1 or 0 times
    *       0 or more times
    +       1 or more times
    {n,m}   at least n but not more than m times
    {n,}    at least n times
    {,n}    at least 0 but not more than n times ({0,n})
    {n}     n times

  reluctant

    ??      1 or 0 times
    *?      0 or more times
    +?      1 or more times
    {n,m}?  at least n but not more than m times  
    {n,}?   at least n times
    {,n}?   at least 0 but not more than n times (== {0,n}?)

  possessive (greedy and does not backtrack after repeated)

    ?+      1 or 0 times
    *+      0 or more times
    ++      1 or more times

    ({n,m}+, {n,}+, {n}+ are possessive op. in ONIG_SYNTAX_JAVA only)

    ex. /a*+/ === /(?&gt;a*)/


5. Anchors

  ^       beginning of the line
  $       end of the line
  \b      word boundary
  \B      not word boundary
  \A      beginning of string
  \Z      end of string, or before newline at the end
  \z      end of string
  \G      matching start position 


6. Character class

  ^...    negative class (lowest precedence operator)
  x-y     range from x to y
  [...]   set (character class in character class)
  ..&amp;&amp;..  intersection (low precedence at the next of ^)

    ex. [a-w&amp;&amp;[^c-g]z] ==&gt; ([a-w] AND ([^c-g] OR z)) ==&gt; [abh-w]

  * If you want to use '[', '-', ']' as a normal character
    in a character class, you should escape these characters by '\'.


  POSIX bracket ([:xxxxx:], negate [:^xxxxx:])

    Not Unicode Case:

      alnum    alphabet or digit char
      alpha    alphabet
      ascii    code value: [0 - 127]
      blank    \t, \x20
      cntrl
      digit    0-9
      graph    include all of multibyte encoded characters
      lower
      print    include all of multibyte encoded characters
      punct
      space    \t, \n, \v, \f, \r, \x20
      upper
      xdigit   0-9, a-f, A-F
      word     alphanumeric, "_" and multibyte characters


    Unicode Case:

      alnum    Letter | Mark | Decimal_Number
      alpha    Letter | Mark
      ascii    0000 - 007F
      blank    Space_Separator | 0009
      cntrl    Control | Format | Unassigned | Private_Use | Surrogate
      digit    Decimal_Number
      graph    [[:^space:]] &amp;&amp; ^Control &amp;&amp; ^Unassigned &amp;&amp; ^Surrogate
      lower    Lowercase_Letter
      print    [[:graph:]] | [[:space:]]
      punct    Connector_Punctuation | Dash_Punctuation | Close_Punctuation |
               Final_Punctuation | Initial_Punctuation | Other_Punctuation |
               Open_Punctuation
      space    Space_Separator | Line_Separator | Paragraph_Separator |
               0009 | 000A | 000B | 000C | 000D | 0085
      upper    Uppercase_Letter
      xdigit   0030 - 0039 | 0041 - 0046 | 0061 - 0066
               (0-9, a-f, A-F)
      word     Letter | Mark | Decimal_Number | Connector_Punctuation



7. Extended groups

  (?#...)            comment

  (?imx-imx)         option on/off
                         i: ignore case
                         m: multi-line (dot(.) match newline)
                         x: extended form
  (?imx-imx:subexp)  option on/off for subexp

  (?:subexp)         not captured group
  (subexp)           captured group

  (?=subexp)         look-ahead
  (?!subexp)         negative look-ahead
  (?&lt;=subexp)        look-behind
  (?&lt;!subexp)        negative look-behind

                     Subexp of look-behind must be fixed character length.
                     But different character length is allowed in top level
                     alternatives only.
                     ex. (?&lt;=a|bc) is OK. (?&lt;=aaa(?:b|cd)) is not allowed.

                     In negative-look-behind, captured group isn't allowed, 
                     but shy group(?:) is allowed.

  (?&gt;subexp)         atomic group
                     don't backtrack in subexp.

  (?&lt;name&gt;subexp), (?'name'subexp)
                     define named group
                     (All characters of the name must be a word character.)

                     Not only a name but a number is assigned like a captured
                     group.

                     Assigning the same name as two or more subexps is allowed.
                     In this case, a subexp call can not be performed although
                     the back reference is possible.


8. Back reference

  \n          back reference by group number (n &gt;= 1)
  \k&lt;name&gt;    back reference by group name
  \k'name'    back reference by group name

  In the back reference by the multiplex definition name,
  a subexp with a large number is referred to preferentially.
  (When not matched, a group of the small number is referred to.)

  * Back reference by group number is forbidden if named group is defined 
    in the pattern and ONIG_OPTION_CAPTURE_GROUP is not setted.


  back reference with nest level

    \k&lt;name+n&gt;     n: 0, 1, 2, ...
    \k&lt;name-n&gt;     n: 0, 1, 2, ...
    \k'name+n'     n: 0, 1, 2, ...
    \k'name-n'     n: 0, 1, 2, ...

    Destinate relative nest level from back reference position.    

    ex 1.

      /\A(?&lt;a&gt;|.|(?:(?&lt;b&gt;.)\g&lt;a&gt;\k&lt;b+0&gt;))\z/.match("reer")

    ex 2.

      r = Regexp.compile(&lt;&lt;'__REGEXP__'.strip, Regexp::EXTENDED)
      (?&lt;element&gt; \g&lt;stag&gt; \g&lt;content&gt;* \g&lt;etag&gt; ){0}
      (?&lt;stag&gt; &lt; \g&lt;name&gt; \s* &gt; ){0}
      (?&lt;name&gt; [a-zA-Z_:]+ ){0}
      (?&lt;content&gt; [^&lt;&amp;]+ (\g&lt;element&gt; | [^&lt;&amp;]+)* ){0}
      (?&lt;etag&gt; &lt;/ \k&lt;name+1&gt; &gt;){0}
      \g&lt;element&gt;
      __REGEXP__

      p r.match('&lt;foo&gt;f&lt;bar&gt;bbb&lt;/bar&gt;f&lt;/foo&gt;').captures



9. Subexp call ("Tanaka Akira special")

  \g&lt;name&gt;    call by group name
  \g'name'    call by group name
  \g&lt;n&gt;       call by group number (n &gt;= 1)
  \g'n'       call by group number (n &gt;= 1)

  * left-most recursive call is not allowed.
     ex. (?&lt;name&gt;a|\g&lt;name&gt;b)   =&gt; error
         (?&lt;name&gt;a|b\g&lt;name&gt;c)  =&gt; OK

  * Call by group number is forbidden if named group is defined in the pattern
    and ONIG_OPTION_CAPTURE_GROUP is not setted.

  * If the option status of called group is different from calling position
    then the group's option is effective.

    ex. (?-i:\g&lt;name&gt;)(?i:(?&lt;name&gt;a)){0}  match to "A"


10. Captured group

  Behavior of the no-named group (...) changes with the following conditions.
  (But named group is not changed.)

  case 1. /.../     (named group is not used, no option)

     (...) is treated as a captured group.

  case 2. /.../g    (named group is not used, 'g' option)

     (...) is treated as a no-captured group (?:...).

  case 3. /..(?&lt;name&gt;..)../   (named group is used, no option)

     (...) is treated as a no-captured group (?:...).
     numbered-backref/call is not allowed.

  case 4. /..(?&lt;name&gt;..)../G  (named group is used, 'G' option)

     (...) is treated as a captured group.
     numbered-backref/call is allowed.

  where
    g: ONIG_OPTION_DONT_CAPTURE_GROUP
    G: ONIG_OPTION_CAPTURE_GROUP

  ('g' and 'G' options are argued in ruby-dev ML)



-----------------------------
A-1. Syntax depend options

   + ONIG_SYNTAX_RUBY
     (?m): dot(.) match newline

   + ONIG_SYNTAX_PERL and ONIG_SYNTAX_JAVA
     (?s): dot(.) match newline
     (?m): ^ match after newline, $ match before newline


A-2. Original extensions

   + hexadecimal digit char type  \h, \H
   + named group                  (?&lt;name&gt;...), (?'name'...)
   + named backref                \k&lt;name&gt;
   + subexp call                  \g&lt;name&gt;, \g&lt;group-num&gt;


A-3. Lacked features compare with perl 5.8.0

   + \N{name}
   + \l,\u,\L,\U, \X, \C
   + (?{code})
   + (??{code})
   + (?(condition)yes-pat|no-pat)

   * \Q...\E
     This is effective on ONIG_SYNTAX_PERL and ONIG_SYNTAX_JAVA.


A-4. Differences with Japanized GNU regex(version 0.12) of Ruby 1.8

   + add character property (\p{property}, \P{property})
   + add hexadecimal digit char type (\h, \H)
   + add look-behind
     (?&lt;=fixed-char-length-pattern), (?&lt;!fixed-char-length-pattern)
   + add possessive quantifier. ?+, *+, ++
   + add operations in character class. [], &amp;&amp;
     ('[' must be escaped as an usual char in character class.)
   + add named group and subexp call.
   + octal or hexadecimal number sequence can be treated as 
     a multibyte code char in character class if multibyte encoding
     is specified.
     (ex. [\xa1\xa2], [\xa1\xa7-\xa4\xa1])
   + allow the range of single byte char and multibyte char in character
     class.
     ex. /[a-&lt;&lt;any EUC-JP character&gt;&gt;]/ in EUC-JP encoding.
   + effect range of isolated option is to next ')'.
     ex. (?:(?i)a|b) is interpreted as (?:(?i:a|b)), not (?:(?i:a)|b).
   + isolated option is not transparent to previous pattern.
     ex. a(?i)* is a syntax error pattern.
   + allowed incompleted left brace as an usual string.
     ex. /{/, /({)/, /a{2,3/ etc...
   + negative POSIX bracket [:^xxxx:] is supported.
   + POSIX bracket [:ascii:] is added.
   + repeat of look-ahead is not allowed.
     ex. /(?=a)*/, /(?!b){5}/
   + Ignore case option is effective to numbered character.
     ex. /\x61/i =~ "A"
   + In the range quantifier, the number of the minimum is omissible.
     /a{,n}/ == /a{0,n}/
     The simultanious abbreviation of the number of times of the minimum
     and the maximum is not allowed. (/a{,}/)
   + /a{n}?/ is not a non-greedy operator.
     /a{n}?/ == /(?:a{n})?/
   + invalid back reference is checked and cause error.
     /\1/, /(a)\2/
   + Zero-length match in infinite repeat stops the repeat,
     then changes of the capture group status are checked as stop condition.
     /(?:()|())*\1\2/ =~ ""
     /(?:\1a|())*/ =~ "a"


A-5. Disabled functions by default syntax

   + capture history

     (?@...) and (?@&lt;name&gt;...)

     ex. /(?@a)*/.match("aaa") ==&gt; [&lt;0-1&gt;, &lt;1-2&gt;, &lt;2-3&gt;]

     see sample/listcap.c file.


A-6. Problems

   + Invalid encoding byte sequence is not checked in UTF-8.

     * Invalid first byte is treated as a character.
       /./u =~ "\xa3"

     * Incomplete byte sequence is not checked.
       /\w+/ =~ "a\xf3\x8ec"

// END
</code></pre>

<h2>20.4 Replacement String Syntax (Format Strings)</h2>

<p>When you perform a regular expression replace, the replace string is interpreted as a format string which can reference captures, perform case foldings, do conditional insertions (based on capture registers) and support a minimal amount of escape sequences.</p>

<h3>20.4.1 Captures</h3>

<p>To reference a capture, use <code>$n</code> where <code>n</code> is the capture register number. Using <code>$0</code> means the entire match.</p>

<p>Example:</p>

<pre><code>   Find: &lt;img src="(.*?)"&gt;
Replace: &lt;img src="$1" alt="$1"&gt;
</code></pre>

<h3>20.4.2 Case Foldings</h3>

<p>It is possible to convert the next character to upper or lowercase by prepending it with <code>\u</code> or <code>\l</code>. This is mainly useful when the next character stems from a capture register. Example:</p>

<pre><code>   Find: (&lt;a.*?&gt;)(.*?)(&lt;/a&gt;)
Replace: $1\u$2$3
</code></pre>

<p>You can also convert a longer sequence to upper or lowercase by using <code>\U</code> or <code>\L</code> and then <code>\E</code> to disable the case folding again. Example:</p>

<pre><code>   Find: (&lt;a.*?&gt;)(.*?)(&lt;/a&gt;)
Replace: $1\U$2\E$3
</code></pre>

<h3>20.4.3 Conditional Insertions</h3>

<p>There are times where the replacements depends on whether or not something was matched. This can be done using <code>(?«n»:«insertion»)</code> to insert <code>«insertion»</code> if capture <code>«n»</code> was matched. You can also use <code>(?«n»:«insertion»:«otherwise»)</code> to have <code>«otherwise»</code> inserted when capture <code>«n»</code> was not matched.</p>

<p>To make a capture conditional either place it in an alternation, e.g. <code>foo|(bar)|fud</code> or append a question mark to it: <code>(bar)?</code>. Note that <code>(.*)</code> will result in a match, even when zero characters are matched, so use <code>(.+)?</code> instead.</p>

<p>So for example if we wish to truncate text to eight words and insert ellipsis only if there were more than eight words, we can use:</p>

<pre><code>   Find: (\w+(?:\W+\w+){,7})\W*(.+)?
Replace: $1(?2:…)
</code></pre>

<p>Here we first match a word (<code>\w+</code>) followed by up to seven words (<code>(?:\W+\w+){,7}</code>) each preceded by non-word characters (spacing). Then optionally put anything following that (separated by non-word characters) into capture register 2 (<code>(.+)?</code>).</p>

<p>The replacement first inserts the (up to) eight words matched (<code>$1</code>) and then only if capture 2 matched something, ellipsis (<code>(?2:…)</code>).</p>

<h3>20.4.4 Escape Codes</h3>

<p>In addition to the case folding escape codes, you can insert a newline character with <code>\n</code>, a tab character with <code>\t</code> and a dollar sign with <code>\$</code>.</p>

		</div>
		<div class="chapter">
			<h1>21 Calling TextMate from Other Applications</h1>

<h2>21.1 Shell / Terminal</h2>

<p>Mac OS X comes with an <a href="http://developer.apple.com/documentation/Darwin/Reference/ManPages/man1/open.1.html"><code>open</code></a> shell command which can be used to simulate a double click from within Terminal. It can also perform an <em>Open With…</em> operation by use of the <code>-a</code> argument, e.g.: <code>open -a TextMate .</code> will open the current folder in TextMate (as a scratch project).</p>

<p>This standard command has a few shortcomings: it can only open one file at a time, it cannot open a document at a specific line and it cannot “stall” the shell until the file has been closed, which is useful e.g. when using an editor to write something like a subversion commit message.</p>

<p>For this reason TextMate comes with its own <code>mate</code> shell command, which supersedes the <code>open</code> command. For usage instructions you can run <code>mate -h</code> (from Terminal).</p>

<p>The <code>mate</code> command is located inside the TextMate application bundle and it is recommended that you create a symbolic link which points to the command (rather than “install” it), so that if the command is updated in the future, you will not need to reinstall the updated command.</p>

<p>Creating a symbolic link can either be done by selecting Help &#x2192; Terminal Usage… from the menu, or from the shell by running something like the following:</p>

<pre><code>ln -s /Applications/TextMate.app/Contents/Resources/mate ~/bin/mate
</code></pre>

<p>This assumes that you have <code>~/bin</code> created and in your path and that TextMate is installed in <code>/Applications</code>.</p>

<p>After having created this link, you may want to setup a few shell variables to make other applications use TextMate as an external editor.</p>

<h3>21.1.1 The General EDITOR Variable</h3>

<p>The <code>EDITOR</code> variable is used by many shell commands, like <code>svn</code> (subversion) and <code>CVS</code>. To use TextMate as the editor for the <code>EDITOR</code> variable, set it like this (for bash and zsh users e.g. in <code>~/.bash_profile</code> or <code>~/.zshrc</code>):</p>

<pre><code>export EDITOR='mate -w'
</code></pre>

<p>We add the <code>-w</code> argument to make the command wait for TextMate to close the file, before continuing.</p>

<p>There is one command which does not support giving arguments in the <code>EDITOR</code> variable, it is <code>crontab</code> (which is sort of obsoleted by <a href="http://developer.apple.com/documentation/Darwin/Reference/ManPages/man8/launchd.8.html">launchd</a>). If you need to use it, you can create a symbolic link to <code>mate</code> with a <code>_wait</code> suffix which implies <code>-w</code>. For example:</p>

<pre><code>ln -s mate ~/bin/mate_wait   # run this once to create the link
export EDITOR='mate_wait'    # use in your ~/.bash_profile
</code></pre>

<h3>21.1.2 Git Editor</h3>

<p>When you commit to a <a href="http://git.or.cz/" title="Git - Fast Version Control System">Git</a> repository you may find that your caret is not at the first line.</p>

<p>This is because Git reuses the temporary file used for the commit message and TextMate stores per-file caret position (via extended attributes).</p>

<p>To avoid this problem you can set the Git editor to <code>mate -wl1</code>. This instructs TextMate to open with the caret at line 1 rather than where it last was.</p>

<p>To set it like this for Git, you can set the <code>GIT_EDITOR</code> variable or Git’s <code>core.editor</code> configuration variable.</p>

<h3>21.1.3 TeX Editor</h3>

<p>When TeX gives an error message relating to a file, you can enter <code>e</code> to edit the file (and correct the error).</p>

<p>To setup TextMate to be used in this case, setup the <code>TEXEDIT</code> variable like this:</p>

<pre><code>export TEXEDIT='mate -w -l %d "%s"'
</code></pre>

<h3>21.1.4 Edit from <code>less</code></h3>

<p>The <code>less</code> pager supports editing the file being viewed by pressing <code>v</code>. To setup TextMate to be used with less, you need to setup the <code>LESSEDIT</code> variable:</p>

<pre><code>export LESSEDIT='mate -l %lm %f'
</code></pre>

<h2>21.2 URL Scheme (HTML)</h2>

<p>The <code>txmt</code> URL scheme allows you to open files in TextMate via hyperlinks found for example in HTML documents (anchors). These can refer to local files which can be useful when:</p>

<ol>
<li><p>Using <a href="commands.html">commands</a> with <a href="commands#html_output.html">HTML output</a> that indicate errors/warnings with the current document, or refer to other documents in your project.</p></li>
<li><p>If you are generating a set of web-pages from simpler (text) files you can have these link to the original text files, so that when you are inspecting the generated result (in a browser) you can quickly edit the source of each page by following the <code>txmt:</code>-link.</p></li>
</ol>

<p>The URL scheme is <code>txmt:</code> and currently has one command named <code>open</code>. This command takes up to three arguments:</p>

<ul>
<li><code>url</code> — the (file) URL to open (e.g. <code>url=file://~/.bash_profile</code>), if this is left out, the current document is targeted.</li>
<li><code>line</code> — the line on which the caret should be placed after opening the file (e.g. <code>line=11</code>).</li>
<li><code>column</code> — the column on which the caret should be placed after opening the file (e.g. <code>column=3</code>).</li>
</ul>

<p>So a full example of a <code>txmt:</code> URL could be (<a href="txmt://open/?url=file://~/.bash_profile&amp;line=11&amp;column=2">click here to test</a>):</p>

<pre><code>txmt://open/?url=file://~/.bash_profile&amp;line=11&amp;column=2
</code></pre>

<h2>21.3 ODB Editor Suite</h2>

<p>TextMate implements the server side of the ODB Editor Suite. This allows it to be used as external editor for programs which implement the client side of the protocol.</p>

<p>Many programs do however use a hardcoded list of which text editors implement the protocol, so if you cannot find TextMate in the list of external editors for an application which does support the ODB Editor Suite, you may need to write to the author of that application and request that TextMate gets added to its list of supported editors.</p>

<p>There is a wiki page which tracks the <a href="http://macromates.com/wiki/Main/TextMateAwarePrograms">status of applications that can be configured to use an external text editor</a>.</p>

<h2>21.4 Cocoa Text Fields</h2>

<p>Included with TextMate is an “Edit in TextMate” input manager which you can install to get the ability to call upon TextMate from the standard Cocoa text editor control (including the one used in Mail). This is useful for programs which do not implement the ODB Editor Suite (e.g. Safari's form elements).</p>

<p>For more info select the <em>Install “Edit in TextMate”…</em> action located in the TextMate bundle (using the gear menu in the status bar). This provides you with full documentation about the input manager before actually installing it.</p>

		</div>
		<div class="chapter">
			<h1>22 Expert Preferences</h1>

<p>TextMate has a few settings which are not exposed in the GUI.</p>

<p>You can change these with the <a href="http://developer.apple.com/documentation/Darwin/Reference/ManPages/man1/defaults.1.html"><code>defaults</code></a> shell command but you need to do this while TextMate is not running.</p>

<p>You set a key to a given value with the following syntax:</p>

<pre><code>defaults write com.macromates.textmate «key» «value»
</code></pre>

<p>You can always reset a key to its default value using:</p>

<pre><code>defaults delete com.macromates.textmate «key»
</code></pre>

<p>Or you can read the value of a key using:</p>

<pre><code>defaults read com.macromates.textmate «key»
</code></pre>

<h2>22.1 <code>NSDragAndDropTextDelay</code></h2>

<p>When you press mouse down on the selection and move the mouse, TextMate will start a new selection, unless you wait 150 milliseconds, then it will instead drag the selection. This delay can be changed by adjusting this preferences value.</p>

<p>Setting it to a value less than zero (e.g. <code>-1</code>) will disable the ability to drag a selection, meaning clicking the mouse inside a selection immediately deselects it and starts a new selection from that point (if the mouse is moved while the button is down).</p>

<p>Setting it to zero will immediately start a drag.</p>

<p>Example:</p>

<pre><code>defaults write com.macromates.textmate NSDragAndDropTextDelay 0
</code></pre>

<h2>22.2 <code>NSRecentDocumentsLimit</code></h2>

<p>This sets the number of documents kept in the "Open Recent" menu. The default value is 25.</p>

<p>Example:</p>

<pre><code>defaults write com.macromates.textmate NSRecentDocumentsLimit 50
</code></pre>

<h2>22.3 <code>OakBundleItemsPopUpMenuKeyEquivalent</code></h2>

<p>The key equivalent which should open the gear menu in the status bar. This is a key equivalent description as used in the <a href="http://macromates.com/blog/archives/2005/07/05/key-bindings-for-switchers/">system key bindings file</a>. The default value is "^\033" (control escape).</p>

<p>For more information about key codes see <a href="http://lists.macromates.com/pipermail/textmate/2006-April/009955.html">this letter</a>.</p>

<h2>22.4 <code>OakBundleManagerDisambiguateMenuFontSize</code></h2>

<p>If you find the font used in the menu to disambiguate tab triggers, key equivalents and similar, too small, then you can run:</p>

<pre><code>defaults write com.macromates.textmate OakBundleManagerDisambiguateMenuFontSize 14
</code></pre>

<h2>22.5 <code>OakDefaultBundleForNewBundleItems</code></h2>

<p>When you create a new item in the bundle editor without having selected a bundle first, then the bundle with the UUID held by this defaults key is used as the target.</p>

<p>This automatically gets set to the first bundle you create. For an example of how to change it see <a href="http://lists.macromates.com/pipermail/textmate/2006-May/010651.html">this letter</a>.</p>

<h2>22.6 <code>OakDefaultLanguage</code></h2>

<p>Sets the default language used for new (untitled) documents. The value should be the UUID of the language to be used.</p>

<p>For more information see <a href="http://lists.macromates.com/pipermail/textmate/2006-February/008276.html">this message from the mailing list</a>.</p>

<h2>22.7 <code>OakDisableSessionRestore</code></h2>

<p>When you launch TextMate it will open the project / document which was open when you last exited. You can however disable this feature by running:</p>

<pre><code>defaults write com.macromates.textmate OakDisableSessionRestore 1
</code></pre>

<h2>22.8 <code>OakDocumentCustomFSMetaData</code></h2>

<p>An array of file systems for which TextMate should use its own functions for storing meta data (<a href="http://developer.apple.com/documentation/Darwin/Reference/ManPages/man2/setxattr.2.html"><code>setxattr</code></a> replacement). The meta data is stored in AppleDouble format. The default value is <code>( afpfs, nfs, msdos )</code> since <code>setxattr</code> can cause a kernel panic for these file systems (<a href="rdar://problem/4162474.html">rdar://4162474</a>).</p>

<p>Example:</p>

<pre><code>defaults write com.macromates.textmate \
   OakDocumentCustomFSMetaData '( afpfs, nfs, msdos, hfs )'
</code></pre>

<h2>22.9 <code>OakDocumentDisableFSMetaData</code></h2>

<p>See <a href="saving_files#extended_attributes_metadata.html">extended attributes</a> for more info.</p>

<h2>22.10 <code>OakFindPanelDisableHistory</code></h2>

<p>This disables the history controls in the find panel. The reason for this setting is only because some users have experienced crashes when using the tab key in the find dialog and this is caused by the history controls used. Currently the only workaround is to disable the use of these controls:</p>

<pre><code>defaults write com.macromates.textmate OakFindPanelDisableHistory 1
</code></pre>

<h2>22.11 <code>OakToolTipMouseMoveIgnorePeriod</code> and <code>OakToolTipMouseDistanceThreshold</code></h2>

<p>When a command brings up a tool tip, mouse movements performed within the first second do not close the tool tip and after that second has elapsed, the mouse needs to be moved at least 5 pixels for the tool tip to close. These values can be adjusted using the <code>OakToolTipMouseMoveIgnorePeriod</code> and <code>OakToolTipMouseDistanceThreshold</code> defaults keys.</p>

<h2>22.12 <code>OakWrapColumns</code></h2>

<p>This is an array of the values which appear in the View → Wrap Column submenu. Defaults to showing 40 and 78 as possible wrap columns.</p>

<p>Example:</p>

<pre><code>defaults write com.macromates.textmate OakWrapColumns '( 60, 70, 80, 120 )'
</code></pre>

<h2>22.13 <code>OakWordsExcludedFromCapitalization</code></h2>

<p>The Text &#x2192; Convert &#x2192; to Titlecase action (&#x2303;&#x2325;U) excludes words found in this array.</p>

<p>The default value is <code>( a, an, and, at, but, by, else, for, from, if, in, nor, of, off, on, or, out, over, the, then, to, up, when )</code>.</p>

		</div>
		<div class="chapter">
			<h1>23 Getting Help</h1>

<h2>23.1 Mailing List</h2>

<p>There is a <a href="http://lists.macromates.com/mailman/listinfo/textmate">mailing list for TextMate</a>. The <a href="http://lists.macromates.com/pipermail/textmate/">archive</a> is public and you can search it with this form:</p>

<form method="GET" action="http://www.google.com/search" accept-charset="utf-8">
    <p>
        <input type="hidden" name="num" value="20">
        <input type="hidden" name="hl" value="en">
        <input type="hidden" name="c2coff" value="1">
        <input type="hidden" name="as_sitesearch" value="lists.macromates.com">
        <input type="text" name="as_q" size="40" class="txt">
        <input type="submit" name="btnG" value="Google Search">
    </p>
</form>

<h2>23.2 IRC Channel</h2>

<p>There is a <code>##textmate</code> IRC channel on <a href="http://freenode.net/">freenode.net</a>.</p>

<h2>23.3 Other Resources</h2>

<h3>23.3.1 TextMate Cheat Sheet</h3>

<p>David Powers has created a <a href="http://www.grayskies.net/textmate">succinct cheat sheet</a> (<a href="http://www.grayskies.net/TMcheatsheet.pdf">direct link to PDF</a>) which you can print and have next to your computer. It lists key equivalents for many useful general actions.</p>

<h3>23.3.2 TextMate Tutorials</h3>

<p>Soryu has written <a href="http://projects.serenity.de/textmate/tutorials/">two TextMate tutorials dealing with setup and basic usage</a>.</p>

<h3>23.3.3 Screencasts</h3>

<p>You can subscribe to the <a href="pcast://macromates.com/textmate/screencast.rss">screencast RSS feed</a> via iTunes.</p>

<p>Here is a list with direct links to a few of the screencasts in recommended viewing order:</p>

<ul>
<li><a href="http://macromates.com/screencast/scopes_and_comments.mov">Scope Based Customizations</a> (21:26)</li>
<li><a href="http://macromates.com/screencast/math_and_column_selections.mov">Working With Numbers and Columns</a> (11:41)</li>
<li><a href="http://macromates.com/screencast/insert_html_tags.mov">Inserting HTML Tags</a> (7:19)</li>
<li><a href="http://macromates.com/screencast/objective-c_part_1.mov">Objective-C Part 1</a> (4:32)</li>
<li><a href="http://macromates.com/screencast/objective_c_part_2.mov">objective-C Part 2</a> (10:39)</li>
</ul>

<p>For the full list with a brief summary see the online <a href="http://macromates.com/screencasts">screencast page</a>.</p>

		</div>
		<div class="chapter">
			<h1>24 Appendix</h1>

<h2>24.1 Property List Format</h2>

<p>Normally TextMate presents settings and such using a GUI, but for the <a href="language_grammars.html">language grammars</a> and <a href="preferences_items.html">preferences items</a> it exposes you to the <a href="http://developer.apple.com/documentation/Cocoa/Conceptual/PropertyLists/Articles/OldStylePListsConcept.html">old-style property list format</a>.</p>

<p>For the purposes of TextMate this format has 3 data types which are described below. Notice that the escape rules for strings have been changed slightly compared to Apple's official format. This was done to make the language grammars more readable, since these need a lot of literal escape characters.</p>

<h3>24.1.1 Strings</h3>

<p>The basic type is a string which can be either single or double quoted.</p>

<p>When the string is single quoted, all characters are verbatim. If you need to put a <code>'</code> inside a single quoted string, you need to use two, for example:</p>

<pre><code>'Normal string'          =&gt; Normal string
'That''s an apostrophe'  =&gt; That's an apostrophe
'String with \backslash' =&gt; String with \backslash
</code></pre>

<p>As you can see, the only interpretation which happens is to convert any occurrence of <code>''</code> to a single <code>'</code>.</p>

<p>Double quoted strings do support escape sequences, apart from <code>\"</code> and <code>\\</code>. For example:</p>

<pre><code>"Normal string"          =&gt; Normal string
"Some \"quoted\" text"   =&gt; Some "quoted" text
"Literal \escape"        =&gt; Literal \escape
"Escaped \\escape"       =&gt; Escaped \escape
"Two \\\escapes"         =&gt; Two \\escapes
</code></pre>

<p>When a string consists entirely of letters, underscores and dashes, it is possible to omit the quotes. For example the following are all legal strings:</p>

<pre><code>foreground-color
this_is_a_string
justLettersInThisOne
</code></pre>

<h3>24.1.2 Arrays</h3>

<p>Arrays are collections of elements, each element can be another array, a string or a dictionary. Elements are comma separated and the entire list is enclosed in parentheses. Some examples:</p>

<pre><code>( "foo", "bar", "fud" )
( "nested", ( "array", "in" ), "array" )
</code></pre>

<p>It is allowable to put a comma after the last element, like this:</p>

<pre><code>( "foo", "bar", "fud", )
</code></pre>

<h3>24.1.3 Dictionaries</h3>

<p>Dictionaries associate a value with a name (key). They are also known as maps, hashes, associative arrays and probably go under a few other terms as well.</p>

<p>The structure is: <code>{ «key» = «value»; }</code> here <code>«key»</code> is a string and <code>«value»</code> can be either an array, string or another dictionary. Some examples:</p>

<pre><code>{ color = "black"; }
{ colors = ( "red", "green", "blue" ); }
</code></pre>

<h2>24.2 Indentation Rules</h2>

<h3>24.2.1 Introduction</h3>

<p>Source code and structured text generally have indentation conventions. TextMate can help you with these if you tell it when to increase and decrease the indent.</p>

<p>Having TextMate figure out the proper indentation is useful when you paste text in another part of the source (where the indentation is different), when you press return on a line that affects the indentation (for next line), or when you press tab at the beginning of the line (and want as much indentation as appropriate for that line).</p>

<h3>24.2.2 The System</h3>

<p>Some languages go a little beyond a single character/keyword to increase and another to decrease, so TextMate has four (regexp) patterns you can set to tell it about your indentation conventions.</p>

<p>The patterns should be set in the Bundle Editor and are set as <a href="preferences_items.html">preference items</a> with the scope set to the scope for which you want the rules to apply (e.g. <code>source.c++</code>).</p>

<p><img src='images/indentation_rules.png' width="442" height="280" alt="Indentation Rules" title=""></p>

<p>We will use the following code example to explain the four patterns:</p>

<pre><code> 1  int main (int argc, char const* argv[])
 2  {
 3     while(true)
 4     {
 5        if(something())
 6           break;
 7  #if 0
 8        play_awful_music();
 9  #else
10        play_nice_music();
11  #endif
12     }
13     return 0;
14  }
</code></pre>

<h3>24.2.3 Increase Pattern</h3>

<p>The <code>increaseIndentPattern</code> should match the lines which increase the indent. In our example above, this is the <code>{</code> characters at lines 2 and 4 (the if on line 5 will be discussed later).</p>

<p>The simple preference for this pattern would be:</p>

<pre><code>increaseIndentPattern = '\{';
</code></pre>

<p>However, since we could have code like this:</p>

<pre><code>int arr[] = { 1, 2, 3 };
</code></pre>

<p>or</p>

<pre><code>str = "foo {";
</code></pre>

<p>we need to make it a little more complicated, by ensuring that no }, <code>"</code> or <code>'</code> will follow the <code>{</code> on the same line. A good choice for languages which use the bracket to start a block would be:</p>

<pre><code>increaseIndentPattern = "^.*\{[^}\"']*$";
</code></pre>

<h3>24.2.4 Decrease Pattern</h3>

<p>The <code>decreaseIndentPattern</code> should match the counterpart of our increase indent pattern. In our example the indent is increased by lines 12 and 14. The character here is } and so the simple decrease indent pattern would be setup as:</p>

<pre><code>decreaseIndentPattern = '\}';
</code></pre>

<p>the more complex version may allow only comment end markers in front of the <code>}</code> and whitespace or <code>;</code> after the <code>}</code>, so with that in mind, we extend the pattern to:</p>

<pre><code>decreaseIndentPattern = '^(.*\*/)?\s*\}[;\s]*$';
</code></pre>

<h3>24.2.5 Increase Only Next Line</h3>

<p>We ignored line 5 in the increase indent pattern, that is because it does not really increase the indent, it only causes the next line to be indented if a block is not started.</p>

<p>For this situation there is the <code>indentNextLinePattern</code>, which should match these lines. We could make it something like:</p>

<pre><code>indentNextLinePattern = 'if|while|for|switch|…';
</code></pre>

<p>But generally in C-like languages, all lines not terminated with a semi-colon (or ending with starting a block), cause the next line to be indented. This is (with most conventions) also the case when manually breaking one expression into several lines, e.g.:</p>

<pre><code>some_function(argument1,
   argument2,
   argument3);

more_code;
</code></pre>

<p>So instead of explicitly matching known language constructs which have the next line indented, we simply match all lines which are not terminated with a semi-colon or brackets. One thing to remember is single-line comments like this:</p>

<pre><code>some_function(arg); // this is terminated
</code></pre>

<p>To solve that, we start with a negative look-ahead assertion in this case and then go on to match lines not terminated by any of the characters mentioned above. The pattern ends up as:</p>

<pre><code>indentNextLinePattern = '^(?!.*;\s*//).*[^\s;{}]\s*$';
</code></pre>

<h3>24.2.6 Ignoring Lines</h3>

<p>Sometimes we have lines which are outside the normal indent, or does not affect the indent despite matching our rather general <code>indentNextLinePattern</code>. In our example these are the preprocessor lines (line 7, 9 and, 11).</p>

<p>To tell TextMate about these lines, there is an <code>unIndentedLinePattern</code> rule. Another case to avoid might be something like this:</p>

<pre><code> 1     some_function();
 2  
 3  /* ignore_first();
 4     ignore_second();
 5  */
 6     more_functions();
</code></pre>

<p>Here line 3 and 5 would count as having zero indent, so we want to ignore these.</p>

<p>To instruct it to ignore preprocessor lines, lines with leading comments or a few Objective-C directives (which are not terminated by a semi-colon), we can use this pattern:</p>

<pre><code>unIndentedLinePattern =
   '^\s*((/\*|\*/\s*$|//|#|@interface|@implementation|@end).*)?$';
</code></pre>

<h2>24.3 Plug-in API</h2>

<p>When launched, TextMate loads plug-ins located in <code>~/‍Library/‍Application Support/‍TextMate/‍PlugIns</code>. The plug-in should be a normal Objective-C bundle with a principal class which will receive an <code>initWithPlugInController:</code> when instantiated.</p>

<p>There is a <a href="http://svn.textmate.org/trunk/Tools/Clock%20Example%20PlugIn/">sample plug-in here</a>. Though other than the startup message, TextMate does not offer any API for the plug-in to use (but will likely do so in the future).</p>

<p>If you are interested in developing plug-ins for TextMate, you can subscribe to the <a href="http://lists.macromates.com/pipermail/textmate-plugins/">plug-ins mailing list</a>.</p>

		</div>
	</div>
</body>
</html>
